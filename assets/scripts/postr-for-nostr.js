/*! For license information please see postr-for-nostr.js.LICENSE.txt */
(()=>{var t={633:(t,e,n)=>{var r=n(738).default;function o(){"use strict";t.exports=o=function(){return n},t.exports.__esModule=!0,t.exports.default=t.exports;var e,n={},s=Object.prototype,i=s.hasOwnProperty,a=Object.defineProperty||function(t,e,n){t[e]=n.value},c="function"==typeof Symbol?Symbol:{},l=c.iterator||"@@iterator",u=c.asyncIterator||"@@asyncIterator",f=c.toStringTag||"@@toStringTag";function h(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{h({},"")}catch(e){h=function(t,e,n){return t[e]=n}}function d(t,e,n,r){var o=e&&e.prototype instanceof v?e:v,s=Object.create(o.prototype),i=new T(r||[]);return a(s,"_invoke",{value:L(t,n,i)}),s}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}n.wrap=d;var y="suspendedStart",g="suspendedYield",w="executing",m="completed",b={};function v(){}function E(){}function x(){}var R={};h(R,l,(function(){return this}));var A=Object.getPrototypeOf,k=A&&A(A(B([])));k&&k!==s&&i.call(k,l)&&(R=k);var S=x.prototype=v.prototype=Object.create(R);function _(t){["next","throw","return"].forEach((function(e){h(t,e,(function(t){return this._invoke(e,t)}))}))}function O(t,e){function n(o,s,a,c){var l=p(t[o],t,s);if("throw"!==l.type){var u=l.arg,f=u.value;return f&&"object"==r(f)&&i.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(f).then((function(t){u.value=t,a(u)}),(function(t){return n("throw",t,a,c)}))}c(l.arg)}var o;a(this,"_invoke",{value:function(t,r){function s(){return new e((function(e,o){n(t,r,e,o)}))}return o=o?o.then(s,s):s()}})}function L(t,n,r){var o=y;return function(s,i){if(o===w)throw Error("Generator is already running");if(o===m){if("throw"===s)throw i;return{value:e,done:!0}}for(r.method=s,r.arg=i;;){var a=r.delegate;if(a){var c=I(a,r);if(c){if(c===b)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===y)throw o=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=w;var l=p(t,n,r);if("normal"===l.type){if(o=r.done?m:g,l.arg===b)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(o=m,r.method="throw",r.arg=l.arg)}}}function I(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,I(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),b;var s=p(o,t.iterator,n.arg);if("throw"===s.type)return n.method="throw",n.arg=s.arg,n.delegate=null,b;var i=s.arg;return i?i.done?(n[t.resultName]=i.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,b):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,b)}function U(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function N(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(U,this),this.reset(!0)}function B(t){if(t||""===t){var n=t[l];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,s=function n(){for(;++o<t.length;)if(i.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return s.next=s}}throw new TypeError(r(t)+" is not iterable")}return E.prototype=x,a(S,"constructor",{value:x,configurable:!0}),a(x,"constructor",{value:E,configurable:!0}),E.displayName=h(x,f,"GeneratorFunction"),n.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===E||"GeneratorFunction"===(e.displayName||e.name))},n.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,h(t,f,"GeneratorFunction")),t.prototype=Object.create(S),t},n.awrap=function(t){return{__await:t}},_(O.prototype),h(O.prototype,u,(function(){return this})),n.AsyncIterator=O,n.async=function(t,e,r,o,s){void 0===s&&(s=Promise);var i=new O(d(t,e,r,o),s);return n.isGeneratorFunction(e)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},_(S),h(S,f,"Generator"),h(S,l,(function(){return this})),h(S,"toString",(function(){return"[object Generator]"})),n.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},n.values=B,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(N),!t)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(r,o){return a.type="throw",a.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o],a=s.completion;if("root"===s.tryLoc)return r("end");if(s.tryLoc<=this.prev){var c=i.call(s,"catchLoc"),l=i.call(s,"finallyLoc");if(c&&l){if(this.prev<s.catchLoc)return r(s.catchLoc,!0);if(this.prev<s.finallyLoc)return r(s.finallyLoc)}else if(c){if(this.prev<s.catchLoc)return r(s.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return r(s.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=t,s.arg=e,o?(this.method="next",this.next=o.finallyLoc,b):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),b},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),N(n),b}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;N(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:B(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),b}},n}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports},738:t=>{function e(n){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(n)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},756:(t,e,n)=>{var r=n(633)();t.exports=r;try{regeneratorRuntime=r}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var s=e[r]={exports:{}};return t[r](s,s.exports,n),s.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{"use strict";var t={};function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function r(t,n){if(t){if("string"==typeof t)return e(t,n);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?e(t,n):void 0}}function o(t,e,n,r,o,s,i){try{var a=t[s](i),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(r,o)}function s(t){return function(){var e=this,n=arguments;return new Promise((function(r,s){var i=t.apply(e,n);function a(t){o(i,r,s,a,c,"next",t)}function c(t){o(i,r,s,a,c,"throw",t)}a(void 0)}))}}function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function a(t,e,n){return(e=function(t){var e=function(t){if("object"!=i(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==i(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function c(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,s,i,a=[],c=!0,l=!1;try{if(s=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(t){l=!0,o=t}finally{try{if(!c&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(l)throw o}}return a}}(t,e)||r(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}n.r(t),n.d(t,{OG:()=>z,My:()=>T,Ph:()=>$,lX:()=>j,Id:()=>q,fg:()=>K,qj:()=>M,aT:()=>P,lq:()=>C,z:()=>H,Q5:()=>V});var l=n(756),u=n.n(l);function f(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function h(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function d(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}const p="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,y=t=>t instanceof Uint8Array,g=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),w=(t,e)=>t<<32-e|t>>>e;if(68!==new Uint8Array(new Uint32Array([287454020]).buffer)[0])throw new Error("Non little-endian hardware is not supported");function m(t){if("string"==typeof t&&(t=function(t){if("string"!=typeof t)throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array((new TextEncoder).encode(t))}(t)),!y(t))throw new Error("expected Uint8Array, got "+typeof t);return t}class b{clone(){return this._cloneInto()}}function v(t){const e=e=>t().update(m(e)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function E(t=32){if(p&&"function"==typeof p.getRandomValues)return p.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}class x extends b{constructor(t,e,n,r){super(),this.blockLen=t,this.outputLen=e,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=g(this.buffer)}update(t){d(this);const{view:e,buffer:n,blockLen:r}=this,o=(t=m(t)).length;for(let s=0;s<o;){const i=Math.min(r-this.pos,o-s);if(i!==r)n.set(t.subarray(s,s+i),this.pos),this.pos+=i,s+=i,this.pos===r&&(this.process(e,0),this.pos=0);else{const e=g(t);for(;r<=o-s;s+=r)this.process(e,s)}}return this.length+=t.length,this.roundClean(),this}digestInto(t){d(this),function(t,e){h(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}(t,this),this.finished=!0;const{buffer:e,view:n,blockLen:r,isLE:o}=this;let{pos:s}=this;e[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>r-s&&(this.process(n,0),s=0);for(let t=s;t<r;t++)e[t]=0;!function(t,e,n,r){if("function"==typeof t.setBigUint64)return t.setBigUint64(e,n,r);const o=BigInt(32),s=BigInt(4294967295),i=Number(n>>o&s),a=Number(n&s),c=r?4:0,l=r?0:4;t.setUint32(e+c,i,r),t.setUint32(e+l,a,r)}(n,r-8,BigInt(8*this.length),o),this.process(n,0);const i=g(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=a/4,l=this.get();if(c>l.length)throw new Error("_sha2: outputLen bigger than state");for(let t=0;t<c;t++)i.setUint32(4*t,l[t],o)}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const n=t.slice(0,e);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:n,length:r,finished:o,destroyed:s,pos:i}=this;return t.length=r,t.pos=i,t.finished=o,t.destroyed=s,r%e&&t.buffer.set(n),t}}const R=(t,e,n)=>t&e^t&n^e&n,A=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),k=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),S=new Uint32Array(64);class _ extends x{constructor(){super(64,32,8,!1),this.A=0|k[0],this.B=0|k[1],this.C=0|k[2],this.D=0|k[3],this.E=0|k[4],this.F=0|k[5],this.G=0|k[6],this.H=0|k[7]}get(){const{A:t,B:e,C:n,D:r,E:o,F:s,G:i,H:a}=this;return[t,e,n,r,o,s,i,a]}set(t,e,n,r,o,s,i,a){this.A=0|t,this.B=0|e,this.C=0|n,this.D=0|r,this.E=0|o,this.F=0|s,this.G=0|i,this.H=0|a}process(t,e){for(let n=0;n<16;n++,e+=4)S[n]=t.getUint32(e,!1);for(let t=16;t<64;t++){const e=S[t-15],n=S[t-2],r=w(e,7)^w(e,18)^e>>>3,o=w(n,17)^w(n,19)^n>>>10;S[t]=o+S[t-7]+r+S[t-16]|0}let{A:n,B:r,C:o,D:s,E:i,F:a,G:c,H:l}=this;for(let t=0;t<64;t++){const e=l+(w(i,6)^w(i,11)^w(i,25))+((u=i)&a^~u&c)+A[t]+S[t]|0,f=(w(n,2)^w(n,13)^w(n,22))+R(n,r,o)|0;l=c,c=a,a=i,i=s+e|0,s=o,o=r,r=n,n=e+f|0}var u;n=n+this.A|0,r=r+this.B|0,o=o+this.C|0,s=s+this.D|0,i=i+this.E|0,a=a+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(n,r,o,s,i,a,c,l)}roundClean(){S.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const O=v((()=>new _)),L=(BigInt(0),BigInt(1)),I=BigInt(2),U=t=>t instanceof Uint8Array,N=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function T(t){if(!U(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=N[t[n]];return e}function B(t){if("string"!=typeof t)throw new Error("hex string expected, got "+typeof t);return BigInt(""===t?"0":`0x${t}`)}function P(t){if("string"!=typeof t)throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let e=0;e<n.length;e++){const r=2*e,o=t.slice(r,r+2),s=Number.parseInt(o,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");n[e]=s}return n}function $(t){return B(T(t))}function j(t){if(!U(t))throw new Error("Uint8Array expected");return B(T(Uint8Array.from(t).reverse()))}function C(t,e){return P(t.toString(16).padStart(2*e,"0"))}function H(t,e){return C(t,e).reverse()}function M(t,e,n){let r;if("string"==typeof e)try{r=P(e)}catch(n){throw new Error(`${t} must be valid hex string, got "${e}". Cause: ${n}`)}else{if(!U(e))throw new Error(`${t} must be hex string or Uint8Array`);r=Uint8Array.from(e)}const o=r.length;if("number"==typeof n&&o!==n)throw new Error(`${t} expected ${n} bytes, got ${o}`);return r}function q(...t){const e=new Uint8Array(t.reduce(((t,e)=>t+e.length),0));let n=0;return t.forEach((t=>{if(!U(t))throw new Error("Uint8Array expected");e.set(t,n),n+=t.length})),e}const z=t=>(I<<BigInt(t-1))-L,W=t=>new Uint8Array(t),D=t=>Uint8Array.from(t);function K(t,e,n){if("number"!=typeof t||t<2)throw new Error("hashLen must be a number");if("number"!=typeof e||e<2)throw new Error("qByteLen must be a number");if("function"!=typeof n)throw new Error("hmacFn must be a function");let r=W(t),o=W(t),s=0;const i=()=>{r.fill(1),o.fill(0),s=0},a=(...t)=>n(o,r,...t),c=(t=W())=>{o=a(D([0]),t),r=a(),0!==t.length&&(o=a(D([1]),t),r=a())},l=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let t=0;const n=[];for(;t<e;){r=a();const e=r.slice();n.push(e),t+=r.length}return q(...n)};return(t,e)=>{let n;for(i(),c(t);!(n=e(l()));)c();return i(),n}}const F={bigint:t=>"bigint"==typeof t,function:t=>"function"==typeof t,boolean:t=>"boolean"==typeof t,string:t=>"string"==typeof t,stringOrUint8Array:t=>"string"==typeof t||t instanceof Uint8Array,isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>"function"==typeof t&&Number.isSafeInteger(t.outputLen)};function V(t,e,n={}){const r=(e,n,r)=>{const o=F[n];if("function"!=typeof o)throw new Error(`Invalid validator "${n}", expected function`);const s=t[e];if(!(r&&void 0===s||o(s,t)))throw new Error(`Invalid param ${String(e)}=${s} (${typeof s}), expected ${n}`)};for(const[t,n]of Object.entries(e))r(t,n,!1);for(const[t,e]of Object.entries(n))r(t,e,!0);return t}const Z=BigInt(0),G=BigInt(1),J=BigInt(2),Y=BigInt(3),Q=BigInt(4),X=BigInt(5),tt=BigInt(8);function et(t,e){const n=t%e;return n>=Z?n:e+n}function nt(t,e,n){if(n<=Z||e<Z)throw new Error("Expected power/modulo > 0");if(n===G)return Z;let r=G;for(;e>Z;)e&G&&(r=r*t%n),t=t*t%n,e>>=G;return r}function rt(t,e,n){let r=t;for(;e-- >Z;)r*=r,r%=n;return r}function ot(t,e){if(t===Z||e<=Z)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=et(t,e),r=e,o=Z,s=G,i=G,a=Z;for(;n!==Z;){const t=r/n,e=r%n,c=o-i*t,l=s-a*t;r=n,n=e,o=i,s=a,i=c,a=l}if(r!==G)throw new Error("invert: does not exist");return et(o,e)}BigInt(9),BigInt(16);const st=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function it(t,e){const n=void 0!==e?e:t.toString(2).length;return{nBitLength:n,nByteLength:Math.ceil(n/8)}}function at(t){if("bigint"!=typeof t)throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function ct(t){const e=at(t);return e+Math.ceil(e/2)}class lt extends b{constructor(t,e){super(),this.finished=!1,this.destroyed=!1,function(t){if("function"!=typeof t||"function"!=typeof t.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");f(t.outputLen),f(t.blockLen)}(t);const n=m(e);if(this.iHash=t.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,o=new Uint8Array(r);o.set(n.length>r?t.create().update(n).digest():n);for(let t=0;t<o.length;t++)o[t]^=54;this.iHash.update(o),this.oHash=t.create();for(let t=0;t<o.length;t++)o[t]^=106;this.oHash.update(o),o.fill(0)}update(t){return d(this),this.iHash.update(t),this}digestInto(t){d(this),h(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:e,iHash:n,finished:r,destroyed:o,blockLen:s,outputLen:i}=this;return t.finished=r,t.destroyed=o,t.blockLen=s,t.outputLen=i,t.oHash=e._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const ut=(t,e,n)=>new lt(t,e).update(n).digest();ut.create=(t,e)=>new lt(t,e);const ft=BigInt(0),ht=BigInt(1);function dt(t){return V(t.Fp,st.reduce(((t,e)=>(t[e]="function",t)),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"})),V(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...it(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const{Ph:pt,aT:yt}=t,gt={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(t){const{Err:e}=gt;if(t.length<2||2!==t[0])throw new e("Invalid signature integer tag");const n=t[1],r=t.subarray(2,n+2);if(!n||r.length!==n)throw new e("Invalid signature integer: wrong length");if(128&r[0])throw new e("Invalid signature integer: negative");if(0===r[0]&&!(128&r[1]))throw new e("Invalid signature integer: unnecessary leading zero");return{d:pt(r),l:t.subarray(n+2)}},toSig(t){const{Err:e}=gt,n="string"==typeof t?yt(t):t;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||48!=n[0])throw new e("Invalid signature tag");if(n[1]!==r-2)throw new e("Invalid signature: incorrect length");const{d:o,l:s}=gt._parseInt(n.subarray(2)),{d:i,l:a}=gt._parseInt(s);if(a.length)throw new e("Invalid signature: left bytes after parsing");return{r:o,s:i}},hexFromSig(t){const e=t=>8&Number.parseInt(t[0],16)?"00"+t:t,n=t=>{const e=t.toString(16);return 1&e.length?`0${e}`:e},r=e(n(t.s)),o=e(n(t.r)),s=r.length/2,i=o.length/2,a=n(s),c=n(i);return`30${n(i+s+4)}02${c}${o}02${a}${r}`}},wt=BigInt(0),mt=BigInt(1),bt=(BigInt(2),BigInt(3));function vt(t){const e=function(t){const e=dt(t);return V(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}(t),{Fp:n,n:r}=e,o=n.BYTES+1,s=2*n.BYTES+1;function i(t){return et(t,r)}function a(t){return ot(t,r)}const{ProjectivePoint:c,normPrivateKeyToScalar:l,weierstrassEquation:u,isWithinCurveOrder:f}=function(t){const e=function(t){const e=dt(t);V(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:o}=e;if(n){if(!r.eql(o,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if("object"!=typeof n||"bigint"!=typeof n.beta||"function"!=typeof n.splitScalar)throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}(t),{Fp:n}=e,r=e.toBytes||((t,e,r)=>{const o=e.toAffine();return q(Uint8Array.from([4]),n.toBytes(o.x),n.toBytes(o.y))}),o=e.fromBytes||(t=>{const e=t.subarray(1);return{x:n.fromBytes(e.subarray(0,n.BYTES)),y:n.fromBytes(e.subarray(n.BYTES,2*n.BYTES))}});function s(t){const{a:r,b:o}=e,s=n.sqr(t),i=n.mul(s,t);return n.add(n.add(i,n.mul(t,r)),o)}if(!n.eql(n.sqr(e.Gy),s(e.Gx)))throw new Error("bad generator point: equation left != right");function i(t){return"bigint"==typeof t&&wt<t&&t<e.n}function a(t){if(!i(t))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(t){const{allowedPrivateKeyLengths:n,nByteLength:r,wrapPrivateKey:o,n:s}=e;if(n&&"bigint"!=typeof t){if(t instanceof Uint8Array&&(t=T(t)),"string"!=typeof t||!n.includes(t.length))throw new Error("Invalid key");t=t.padStart(2*r,"0")}let i;try{i="bigint"==typeof t?t:$(M("private key",t,r))}catch(e){throw new Error(`private key must be ${r} bytes, hex or bigint, not ${typeof t}`)}return o&&(i=et(i,s)),a(i),i}const l=new Map;function u(t){if(!(t instanceof f))throw new Error("ProjectivePoint expected")}class f{constructor(t,e,r){if(this.px=t,this.py=e,this.pz=r,null==t||!n.isValid(t))throw new Error("x required");if(null==e||!n.isValid(e))throw new Error("y required");if(null==r||!n.isValid(r))throw new Error("z required")}static fromAffine(t){const{x:e,y:r}=t||{};if(!t||!n.isValid(e)||!n.isValid(r))throw new Error("invalid affine point");if(t instanceof f)throw new Error("projective point not allowed");const o=t=>n.eql(t,n.ZERO);return o(e)&&o(r)?f.ZERO:new f(e,r,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(t){const e=n.invertBatch(t.map((t=>t.pz)));return t.map(((t,n)=>t.toAffine(e[n]))).map(f.fromAffine)}static fromHex(t){const e=f.fromAffine(o(M("pointHex",t)));return e.assertValidity(),e}static fromPrivateKey(t){return f.BASE.multiply(c(t))}_setWindowSize(t){this._WINDOW_SIZE=t,l.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:t,y:r}=this.toAffine();if(!n.isValid(t)||!n.isValid(r))throw new Error("bad point: x or y not FE");const o=n.sqr(r),i=s(t);if(!n.eql(o,i))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:t}=this.toAffine();if(n.isOdd)return!n.isOdd(t);throw new Error("Field doesn't support isOdd")}equals(t){u(t);const{px:e,py:r,pz:o}=this,{px:s,py:i,pz:a}=t,c=n.eql(n.mul(e,a),n.mul(s,o)),l=n.eql(n.mul(r,a),n.mul(i,o));return c&&l}negate(){return new f(this.px,n.neg(this.py),this.pz)}double(){const{a:t,b:r}=e,o=n.mul(r,bt),{px:s,py:i,pz:a}=this;let c=n.ZERO,l=n.ZERO,u=n.ZERO,h=n.mul(s,s),d=n.mul(i,i),p=n.mul(a,a),y=n.mul(s,i);return y=n.add(y,y),u=n.mul(s,a),u=n.add(u,u),c=n.mul(t,u),l=n.mul(o,p),l=n.add(c,l),c=n.sub(d,l),l=n.add(d,l),l=n.mul(c,l),c=n.mul(y,c),u=n.mul(o,u),p=n.mul(t,p),y=n.sub(h,p),y=n.mul(t,y),y=n.add(y,u),u=n.add(h,h),h=n.add(u,h),h=n.add(h,p),h=n.mul(h,y),l=n.add(l,h),p=n.mul(i,a),p=n.add(p,p),h=n.mul(p,y),c=n.sub(c,h),u=n.mul(p,d),u=n.add(u,u),u=n.add(u,u),new f(c,l,u)}add(t){u(t);const{px:r,py:o,pz:s}=this,{px:i,py:a,pz:c}=t;let l=n.ZERO,h=n.ZERO,d=n.ZERO;const p=e.a,y=n.mul(e.b,bt);let g=n.mul(r,i),w=n.mul(o,a),m=n.mul(s,c),b=n.add(r,o),v=n.add(i,a);b=n.mul(b,v),v=n.add(g,w),b=n.sub(b,v),v=n.add(r,s);let E=n.add(i,c);return v=n.mul(v,E),E=n.add(g,m),v=n.sub(v,E),E=n.add(o,s),l=n.add(a,c),E=n.mul(E,l),l=n.add(w,m),E=n.sub(E,l),d=n.mul(p,v),l=n.mul(y,m),d=n.add(l,d),l=n.sub(w,d),d=n.add(w,d),h=n.mul(l,d),w=n.add(g,g),w=n.add(w,g),m=n.mul(p,m),v=n.mul(y,v),w=n.add(w,m),m=n.sub(g,m),m=n.mul(p,m),v=n.add(v,m),g=n.mul(w,v),h=n.add(h,g),g=n.mul(E,v),l=n.mul(b,l),l=n.sub(l,g),g=n.mul(b,w),d=n.mul(E,d),d=n.add(d,g),new f(l,h,d)}subtract(t){return this.add(t.negate())}is0(){return this.equals(f.ZERO)}wNAF(t){return d.wNAFCached(this,l,t,(t=>{const e=n.invertBatch(t.map((t=>t.pz)));return t.map(((t,n)=>t.toAffine(e[n]))).map(f.fromAffine)}))}multiplyUnsafe(t){const r=f.ZERO;if(t===wt)return r;if(a(t),t===mt)return this;const{endo:o}=e;if(!o)return d.unsafeLadder(this,t);let{k1neg:s,k1:i,k2neg:c,k2:l}=o.splitScalar(t),u=r,h=r,p=this;for(;i>wt||l>wt;)i&mt&&(u=u.add(p)),l&mt&&(h=h.add(p)),p=p.double(),i>>=mt,l>>=mt;return s&&(u=u.negate()),c&&(h=h.negate()),h=new f(n.mul(h.px,o.beta),h.py,h.pz),u.add(h)}multiply(t){a(t);let r,o,s=t;const{endo:i}=e;if(i){const{k1neg:t,k1:e,k2neg:a,k2:c}=i.splitScalar(s);let{p:l,f:u}=this.wNAF(e),{p:h,f:p}=this.wNAF(c);l=d.constTimeNegate(t,l),h=d.constTimeNegate(a,h),h=new f(n.mul(h.px,i.beta),h.py,h.pz),r=l.add(h),o=u.add(p)}else{const{p:t,f:e}=this.wNAF(s);r=t,o=e}return f.normalizeZ([r,o])[0]}multiplyAndAddUnsafe(t,e,n){const r=f.BASE,o=(t,e)=>e!==wt&&e!==mt&&t.equals(r)?t.multiply(e):t.multiplyUnsafe(e),s=o(this,e).add(o(t,n));return s.is0()?void 0:s}toAffine(t){const{px:e,py:r,pz:o}=this,s=this.is0();null==t&&(t=s?n.ONE:n.inv(o));const i=n.mul(e,t),a=n.mul(r,t),c=n.mul(o,t);if(s)return{x:n.ZERO,y:n.ZERO};if(!n.eql(c,n.ONE))throw new Error("invZ was invalid");return{x:i,y:a}}isTorsionFree(){const{h:t,isTorsionFree:n}=e;if(t===mt)return!0;if(n)return n(f,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:t,clearCofactor:n}=e;return t===mt?this:n?n(f,this):this.multiplyUnsafe(e.h)}toRawBytes(t=!0){return this.assertValidity(),r(f,this,t)}toHex(t=!0){return T(this.toRawBytes(t))}}f.BASE=new f(e.Gx,e.Gy,n.ONE),f.ZERO=new f(n.ZERO,n.ONE,n.ZERO);const h=e.nBitLength,d=function(t,e){const n=(t,e)=>{const n=e.negate();return t?n:e},r=t=>({windows:Math.ceil(e/t)+1,windowSize:2**(t-1)});return{constTimeNegate:n,unsafeLadder(e,n){let r=t.ZERO,o=e;for(;n>ft;)n&ht&&(r=r.add(o)),o=o.double(),n>>=ht;return r},precomputeWindow(t,e){const{windows:n,windowSize:o}=r(e),s=[];let i=t,a=i;for(let t=0;t<n;t++){a=i,s.push(a);for(let t=1;t<o;t++)a=a.add(i),s.push(a);i=a.double()}return s},wNAF(e,o,s){const{windows:i,windowSize:a}=r(e);let c=t.ZERO,l=t.BASE;const u=BigInt(2**e-1),f=2**e,h=BigInt(e);for(let t=0;t<i;t++){const e=t*a;let r=Number(s&u);s>>=h,r>a&&(r-=f,s+=ht);const i=e,d=e+Math.abs(r)-1,p=t%2!=0,y=r<0;0===r?l=l.add(n(p,o[i])):c=c.add(n(y,o[d]))}return{p:c,f:l}},wNAFCached(t,e,n,r){const o=t._WINDOW_SIZE||1;let s=e.get(t);return s||(s=this.precomputeWindow(t,o),1!==o&&e.set(t,r(s))),this.wNAF(o,s,n)}}}(f,e.endo?Math.ceil(h/2):h);return{CURVE:e,ProjectivePoint:f,normPrivateKeyToScalar:c,weierstrassEquation:s,isWithinCurveOrder:i}}({...e,toBytes(t,e,r){const o=e.toAffine(),s=n.toBytes(o.x),i=q;return r?i(Uint8Array.from([e.hasEvenY()?2:3]),s):i(Uint8Array.from([4]),s,n.toBytes(o.y))},fromBytes(t){const e=t.length,r=t[0],i=t.subarray(1);if(e!==o||2!==r&&3!==r){if(e===s&&4===r)return{x:n.fromBytes(i.subarray(0,n.BYTES)),y:n.fromBytes(i.subarray(n.BYTES,2*n.BYTES))};throw new Error(`Point of length ${e} was invalid. Expected ${o} compressed bytes or ${s} uncompressed bytes`)}{const t=$(i);if(!(wt<(a=t)&&a<n.ORDER))throw new Error("Point is not on curve");const e=u(t);let o=n.sqrt(e);return!(1&~r)!=((o&mt)===mt)&&(o=n.neg(o)),{x:t,y:o}}var a}}),h=t=>T(C(t,e.nByteLength));function d(t){return t>r>>mt}const p=(t,e,n)=>$(t.slice(e,n));class y{constructor(t,e,n){this.r=t,this.s=e,this.recovery=n,this.assertValidity()}static fromCompact(t){const n=e.nByteLength;return t=M("compactSignature",t,2*n),new y(p(t,0,n),p(t,n,2*n))}static fromDER(t){const{r:e,s:n}=gt.toSig(M("DER",t));return new y(e,n)}assertValidity(){if(!f(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!f(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(t){return new y(this.r,this.s,t)}recoverPublicKey(t){const{r,s:o,recovery:s}=this,l=b(M("msgHash",t));if(null==s||![0,1,2,3].includes(s))throw new Error("recovery id invalid");const u=2===s||3===s?r+e.n:r;if(u>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const f=1&s?"03":"02",d=c.fromHex(f+h(u)),p=a(u),y=i(-l*p),g=i(o*p),w=c.BASE.multiplyAndAddUnsafe(d,y,g);if(!w)throw new Error("point at infinify");return w.assertValidity(),w}hasHighS(){return d(this.s)}normalizeS(){return this.hasHighS()?new y(this.r,i(-this.s),this.recovery):this}toDERRawBytes(){return P(this.toDERHex())}toDERHex(){return gt.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return P(this.toCompactHex())}toCompactHex(){return h(this.r)+h(this.s)}}const g={isValidPrivateKey(t){try{return l(t),!0}catch(t){return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{const t=ct(e.n);return function(t,e,n=!1){const r=t.length,o=at(e),s=ct(e);if(r<16||r<s||r>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${r}`);const i=et(n?$(t):j(t),e-G)+G;return n?H(i,o):C(i,o)}(e.randomBytes(t),e.n)},precompute:(t=8,e=c.BASE)=>(e._setWindowSize(t),e.multiply(BigInt(3)),e)};function w(t){const e=t instanceof Uint8Array,n="string"==typeof t,r=(e||n)&&t.length;return e?r===o||r===s:n?r===2*o||r===2*s:t instanceof c}const m=e.bits2int||function(t){const n=$(t),r=8*t.length-e.nBitLength;return r>0?n>>BigInt(r):n},b=e.bits2int_modN||function(t){return i(m(t))},v=z(e.nBitLength);function E(t){if("bigint"!=typeof t)throw new Error("bigint expected");if(!(wt<=t&&t<v))throw new Error(`bigint expected < 2^${e.nBitLength}`);return C(t,e.nByteLength)}const x={lowS:e.lowS,prehash:!1},R={lowS:e.lowS,prehash:!1};return c.BASE._setWindowSize(8),{CURVE:e,getPublicKey:function(t,e=!0){return c.fromPrivateKey(t).toRawBytes(e)},getSharedSecret:function(t,e,n=!0){if(w(t))throw new Error("first arg must be private key");if(!w(e))throw new Error("second arg must be public key");return c.fromHex(e).multiply(l(t)).toRawBytes(n)},sign:function(t,r,o=x){const{seed:s,k2sig:u}=function(t,r,o=x){if(["recovered","canonical"].some((t=>t in o)))throw new Error("sign() legacy options not supported");const{hash:s,randomBytes:u}=e;let{lowS:h,prehash:p,extraEntropy:g}=o;null==h&&(h=!0),t=M("msgHash",t),p&&(t=M("prehashed msgHash",s(t)));const w=b(t),v=l(r),R=[E(v),E(w)];if(null!=g){const t=!0===g?u(n.BYTES):g;R.push(M("extraEntropy",t))}const A=q(...R),k=w;return{seed:A,k2sig:function(t){const e=m(t);if(!f(e))return;const n=a(e),r=c.BASE.multiply(e).toAffine(),o=i(r.x);if(o===wt)return;const s=i(n*i(k+o*v));if(s===wt)return;let l=(r.x===o?0:2)|Number(r.y&mt),u=s;return h&&d(s)&&(u=function(t){return d(t)?i(-t):t}(s),l^=1),new y(o,u,l)}}}(t,r,o),h=e;return K(h.hash.outputLen,h.nByteLength,h.hmac)(s,u)},verify:function(t,n,r,o=R){const s=t;if(n=M("msgHash",n),r=M("publicKey",r),"strict"in o)throw new Error("options.strict was renamed to lowS");const{lowS:l,prehash:u}=o;let f,h;try{if("string"==typeof s||s instanceof Uint8Array)try{f=y.fromDER(s)}catch(t){if(!(t instanceof gt.Err))throw t;f=y.fromCompact(s)}else{if("object"!=typeof s||"bigint"!=typeof s.r||"bigint"!=typeof s.s)throw new Error("PARSE");{const{r:t,s:e}=s;f=new y(t,e)}}h=c.fromHex(r)}catch(t){if("PARSE"===t.message)throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(l&&f.hasHighS())return!1;u&&(n=e.hash(n));const{r:d,s:p}=f,g=b(n),w=a(p),m=i(g*w),v=i(d*w),E=c.BASE.multiplyAndAddUnsafe(h,m,v)?.toAffine();return!!E&&i(E.x)===d},ProjectivePoint:c,Signature:y,utils:g}}function Et(t){return{hash:t,hmac:(e,...n)=>ut(t,e,function(...t){const e=new Uint8Array(t.reduce(((t,e)=>t+e.length),0));let n=0;return t.forEach((t=>{if(!y(t))throw new Error("Uint8Array expected");e.set(t,n),n+=t.length})),e}(...n)),randomBytes:E}}BigInt(4);const xt=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Rt=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),At=BigInt(1),kt=BigInt(2),St=(t,e)=>(t+e/kt)/e;function _t(t){const e=xt,n=BigInt(3),r=BigInt(6),o=BigInt(11),s=BigInt(22),i=BigInt(23),a=BigInt(44),c=BigInt(88),l=t*t*t%e,u=l*l*t%e,f=rt(u,n,e)*u%e,h=rt(f,n,e)*u%e,d=rt(h,kt,e)*l%e,p=rt(d,o,e)*d%e,y=rt(p,s,e)*p%e,g=rt(y,a,e)*y%e,w=rt(g,c,e)*g%e,m=rt(w,a,e)*y%e,b=rt(m,n,e)*u%e,v=rt(b,i,e)*p%e,E=rt(v,r,e)*l%e,x=rt(E,kt,e);if(!Ot.eql(Ot.sqr(x),t))throw new Error("Cannot find square root");return x}const Ot=function(t,e,n=!1,r={}){if(t<=Z)throw new Error(`Expected Field ORDER > 0, got ${t}`);const{nBitLength:o,nByteLength:s}=it(t,e);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");const i=function(t){if(t%Q===Y){const e=(t+G)/Q;return function(t,n){const r=t.pow(n,e);if(!t.eql(t.sqr(r),n))throw new Error("Cannot find square root");return r}}if(t%tt===X){const e=(t-X)/tt;return function(t,n){const r=t.mul(n,J),o=t.pow(r,e),s=t.mul(n,o),i=t.mul(t.mul(s,J),o),a=t.mul(s,t.sub(i,t.ONE));if(!t.eql(t.sqr(a),n))throw new Error("Cannot find square root");return a}}return function(t){const e=(t-G)/J;let n,r,o;for(n=t-G,r=0;n%J===Z;n/=J,r++);for(o=J;o<t&&nt(o,e,t)!==t-G;o++);if(1===r){const e=(t+G)/Q;return function(t,n){const r=t.pow(n,e);if(!t.eql(t.sqr(r),n))throw new Error("Cannot find square root");return r}}const s=(n+G)/J;return function(t,i){if(t.pow(i,e)===t.neg(t.ONE))throw new Error("Cannot find square root");let a=r,c=t.pow(t.mul(t.ONE,o),n),l=t.pow(i,s),u=t.pow(i,n);for(;!t.eql(u,t.ONE);){if(t.eql(u,t.ZERO))return t.ZERO;let e=1;for(let n=t.sqr(u);e<a&&!t.eql(n,t.ONE);e++)n=t.sqr(n);const n=t.pow(c,G<<BigInt(a-e-1));c=t.sqr(n),l=t.mul(l,n),u=t.mul(u,c),a=e}return l}}(t)}(t),a=Object.freeze({ORDER:t,BITS:o,BYTES:s,MASK:z(o),ZERO:Z,ONE:G,create:e=>et(e,t),isValid:e=>{if("bigint"!=typeof e)throw new Error("Invalid field element: expected bigint, got "+typeof e);return Z<=e&&e<t},is0:t=>t===Z,isOdd:t=>(t&G)===G,neg:e=>et(-e,t),eql:(t,e)=>t===e,sqr:e=>et(e*e,t),add:(e,n)=>et(e+n,t),sub:(e,n)=>et(e-n,t),mul:(e,n)=>et(e*n,t),pow:(t,e)=>function(t,e,n){if(n<Z)throw new Error("Expected power > 0");if(n===Z)return t.ONE;if(n===G)return e;let r=t.ONE,o=e;for(;n>Z;)n&G&&(r=t.mul(r,o)),o=t.sqr(o),n>>=G;return r}(a,t,e),div:(e,n)=>et(e*ot(n,t),t),sqrN:t=>t*t,addN:(t,e)=>t+e,subN:(t,e)=>t-e,mulN:(t,e)=>t*e,inv:e=>ot(e,t),sqrt:r.sqrt||(t=>i(a,t)),invertBatch:t=>function(t,e){const n=new Array(e.length),r=e.reduce(((e,r,o)=>t.is0(r)?e:(n[o]=e,t.mul(e,r))),t.ONE),o=t.inv(r);return e.reduceRight(((e,r,o)=>t.is0(r)?e:(n[o]=t.mul(e,n[o]),t.mul(e,r))),o),n}(a,t),cmov:(t,e,n)=>n?e:t,toBytes:t=>n?H(t,s):C(t,s),fromBytes:t=>{if(t.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${t.length}`);return n?j(t):$(t)}});return Object.freeze(a)}(xt,void 0,void 0,{sqrt:_t}),Lt=function(t,e){const n=e=>vt({...t,...Et(e)});return Object.freeze({...n(e),create:n})}({a:BigInt(0),b:BigInt(7),Fp:Ot,n:Rt,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=Rt,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-At*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,i=BigInt("0x100000000000000000000000000000000"),a=St(s*t,e),c=St(-r*t,e);let l=et(t-a*n-c*o,e),u=et(-a*r-c*s,e);const f=l>i,h=u>i;if(f&&(l=e-l),h&&(u=e-u),l>i||u>i)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:f,k1:l,k2neg:h,k2:u}}}},O),It=BigInt(0),Ut=t=>"bigint"==typeof t&&It<t&&t<xt,Nt={};function Tt(t,...e){let n=Nt[t];if(void 0===n){const e=O(Uint8Array.from(t,(t=>t.charCodeAt(0))));n=q(e,e),Nt[t]=n}return O(q(n,...e))}const Bt=t=>t.toRawBytes(!0).slice(1),Pt=t=>C(t,32),$t=t=>et(t,xt),jt=t=>et(t,Rt),Ct=Lt.ProjectivePoint;function Ht(t){let e=Lt.utils.normPrivateKeyToScalar(t),n=Ct.fromPrivateKey(e);return{scalar:n.hasEvenY()?e:jt(-e),bytes:Bt(n)}}function Mt(t){if(!Ut(t))throw new Error("bad x: need 0 < x < p");const e=$t(t*t);let n=_t($t(e*t+BigInt(7)));n%kt!==It&&(n=$t(-n));const r=new Ct(t,n,At);return r.assertValidity(),r}function qt(...t){return jt($(Tt("BIP0340/challenge",...t)))}function zt(t){return Ht(t).bytes}function Wt(t,e,n=E(32)){const r=M("message",t),{bytes:o,scalar:s}=Ht(e),i=M("auxRand",n,32),a=Pt(s^$(Tt("BIP0340/aux",i))),c=Tt("BIP0340/nonce",a,o,r),l=jt($(c));if(l===It)throw new Error("sign failed: k is zero");const{bytes:u,scalar:f}=Ht(l),h=qt(u,o,r),d=new Uint8Array(64);if(d.set(u,0),d.set(Pt(jt(f+h*s)),32),!Dt(d,r,o))throw new Error("sign: Invalid signature produced");return d}function Dt(t,e,n){const r=M("signature",t,64),o=M("message",e),s=M("publicKey",n,32);try{const t=Mt($(s)),e=$(r.subarray(0,32));if(!Ut(e))return!1;const n=$(r.subarray(32,64));if(!("bigint"==typeof(l=n)&&It<l&&l<Rt))return!1;const u=qt(Pt(e),Bt(t),o),f=(i=t,a=n,c=jt(-u),Ct.BASE.multiplyAndAddUnsafe(i,a,c));return!(!f||!f.hasEvenY()||f.toAffine().x!==e)}catch(t){return!1}var i,a,c,l}const Kt=(()=>({getPublicKey:zt,sign:Wt,verify:Dt,utils:{randomPrivateKey:Lt.utils.randomPrivateKey,lift_x:Mt,pointToBytes:Bt,numberToBytesBE:C,bytesToNumberBE:$,taggedHash:Tt,mod:et}}))(),Ft="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,Vt=t=>t instanceof Uint8Array,Zt=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),Gt=(t,e)=>t<<32-e|t>>>e;if(68!==new Uint8Array(new Uint32Array([287454020]).buffer)[0])throw new Error("Non little-endian hardware is not supported");const Jt=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function Yt(t){if(!Vt(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=Jt[t[n]];return e}function Qt(t){if("string"!=typeof t)throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let e=0;e<n.length;e++){const r=2*e,o=t.slice(r,r+2),s=Number.parseInt(o,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");n[e]=s}return n}function Xt(t){if("string"==typeof t&&(t=function(t){if("string"!=typeof t)throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array((new TextEncoder).encode(t))}(t)),!Vt(t))throw new Error("expected Uint8Array, got "+typeof t);return t}function te(...t){const e=new Uint8Array(t.reduce(((t,e)=>t+e.length),0));let n=0;return t.forEach((t=>{if(!Vt(t))throw new Error("Uint8Array expected");e.set(t,n),n+=t.length})),e}class ee{clone(){return this._cloneInto()}}function ne(t){const e=e=>t().update(Xt(e)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function re(t=32){if(Ft&&"function"==typeof Ft.getRandomValues)return Ft.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function oe(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function se(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}const ie={number:oe,bool:function(t){if("boolean"!=typeof t)throw new Error(`Expected boolean, not ${t}`)},bytes:se,hash:function(t){if("function"!=typeof t||"function"!=typeof t.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");oe(t.outputLen),oe(t.blockLen)},exists:function(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")},output:function(t,e){se(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}};class ae extends ee{constructor(t,e,n,r){super(),this.blockLen=t,this.outputLen=e,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Zt(this.buffer)}update(t){ie.exists(this);const{view:e,buffer:n,blockLen:r}=this,o=(t=Xt(t)).length;for(let s=0;s<o;){const i=Math.min(r-this.pos,o-s);if(i!==r)n.set(t.subarray(s,s+i),this.pos),this.pos+=i,s+=i,this.pos===r&&(this.process(e,0),this.pos=0);else{const e=Zt(t);for(;r<=o-s;s+=r)this.process(e,s)}}return this.length+=t.length,this.roundClean(),this}digestInto(t){ie.exists(this),ie.output(t,this),this.finished=!0;const{buffer:e,view:n,blockLen:r,isLE:o}=this;let{pos:s}=this;e[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>r-s&&(this.process(n,0),s=0);for(let t=s;t<r;t++)e[t]=0;!function(t,e,n,r){if("function"==typeof t.setBigUint64)return t.setBigUint64(e,n,r);const o=BigInt(32),s=BigInt(4294967295),i=Number(n>>o&s),a=Number(n&s),c=r?4:0,l=r?0:4;t.setUint32(e+c,i,r),t.setUint32(e+l,a,r)}(n,r-8,BigInt(8*this.length),o),this.process(n,0);const i=Zt(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=a/4,l=this.get();if(c>l.length)throw new Error("_sha2: outputLen bigger than state");for(let t=0;t<c;t++)i.setUint32(4*t,l[t],o)}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const n=t.slice(0,e);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:n,length:r,finished:o,destroyed:s,pos:i}=this;return t.length=r,t.pos=i,t.finished=o,t.destroyed=s,r%e&&t.buffer.set(n),t}}const ce=(t,e,n)=>t&e^t&n^e&n,le=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ue=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),fe=new Uint32Array(64);class he extends ae{constructor(){super(64,32,8,!1),this.A=0|ue[0],this.B=0|ue[1],this.C=0|ue[2],this.D=0|ue[3],this.E=0|ue[4],this.F=0|ue[5],this.G=0|ue[6],this.H=0|ue[7]}get(){const{A:t,B:e,C:n,D:r,E:o,F:s,G:i,H:a}=this;return[t,e,n,r,o,s,i,a]}set(t,e,n,r,o,s,i,a){this.A=0|t,this.B=0|e,this.C=0|n,this.D=0|r,this.E=0|o,this.F=0|s,this.G=0|i,this.H=0|a}process(t,e){for(let n=0;n<16;n++,e+=4)fe[n]=t.getUint32(e,!1);for(let t=16;t<64;t++){const e=fe[t-15],n=fe[t-2],r=Gt(e,7)^Gt(e,18)^e>>>3,o=Gt(n,17)^Gt(n,19)^n>>>10;fe[t]=o+fe[t-7]+r+fe[t-16]|0}let{A:n,B:r,C:o,D:s,E:i,F:a,G:c,H:l}=this;for(let t=0;t<64;t++){const e=l+(Gt(i,6)^Gt(i,11)^Gt(i,25))+((u=i)&a^~u&c)+le[t]+fe[t]|0,f=(Gt(n,2)^Gt(n,13)^Gt(n,22))+ce(n,r,o)|0;l=c,c=a,a=i,i=s+e|0,s=o,o=r,r=n,n=e+f|0}var u;n=n+this.A|0,r=r+this.B|0,o=o+this.C|0,s=s+this.D|0,i=i+this.E|0,a=a+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(n,r,o,s,i,a,c,l)}roundClean(){fe.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class de extends he{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const pe=ne((()=>new he));function ye(t){if(!Number.isSafeInteger(t))throw new Error(`Wrong integer: ${t}`)}function ge(...t){const e=(t,e)=>n=>t(e(n)),n=Array.from(t).reverse().reduce(((t,n)=>t?e(t,n.encode):n.encode),void 0),r=t.reduce(((t,n)=>t?e(t,n.decode):n.decode),void 0);return{encode:n,decode:r}}function we(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&"number"!=typeof e[0])throw new Error("alphabet.encode input should be an array of numbers");return e.map((e=>{if(ye(e),e<0||e>=t.length)throw new Error(`Digit index outside alphabet: ${e} (alphabet: ${t.length})`);return t[e]}))},decode:e=>{if(!Array.isArray(e)||e.length&&"string"!=typeof e[0])throw new Error("alphabet.decode input should be array of strings");return e.map((e=>{if("string"!=typeof e)throw new Error(`alphabet.decode: not string element=${e}`);const n=t.indexOf(e);if(-1===n)throw new Error(`Unknown letter: "${e}". Allowed: ${t}`);return n}))}}}function me(t=""){if("string"!=typeof t)throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&"string"!=typeof e[0])throw new Error("join.encode input should be array of strings");for(let t of e)if("string"!=typeof t)throw new Error(`join.encode: non-string input=${t}`);return e.join(t)},decode:e=>{if("string"!=typeof e)throw new Error("join.decode input should be string");return e.split(t)}}}function be(t,e="="){if(ye(t),"string"!=typeof e)throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&"string"!=typeof n[0])throw new Error("padding.encode input should be array of strings");for(let t of n)if("string"!=typeof t)throw new Error(`padding.encode: non-string input=${t}`);for(;n.length*t%8;)n.push(e);return n},decode(n){if(!Array.isArray(n)||n.length&&"string"!=typeof n[0])throw new Error("padding.encode input should be array of strings");for(let t of n)if("string"!=typeof t)throw new Error(`padding.decode: non-string input=${t}`);let r=n.length;if(r*t%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===e;r--)if(!((r-1)*t%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function ve(t){if("function"!=typeof t)throw new Error("normalize fn should be function");return{encode:t=>t,decode:e=>t(e)}}function Ee(t,e,n){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(t))throw new Error("convertRadix: data should be array");if(!t.length)return[];let r=0;const o=[],s=Array.from(t);for(s.forEach((t=>{if(ye(t),t<0||t>=e)throw new Error(`Wrong integer: ${t}`)}));;){let t=0,i=!0;for(let o=r;o<s.length;o++){const a=s[o],c=e*t+a;if(!Number.isSafeInteger(c)||e*t/e!==t||c-a!=e*t)throw new Error("convertRadix: carry overflow");if(t=c%n,s[o]=Math.floor(c/n),!Number.isSafeInteger(s[o])||s[o]*n+t!==c)throw new Error("convertRadix: carry overflow");i&&(s[o]?i=!1:r=o)}if(o.push(t),i)break}for(let e=0;e<t.length-1&&0===t[e];e++)o.push(0);return o.reverse()}ne((()=>new de));const xe=(t,e)=>e?xe(e,t%e):t,Re=(t,e)=>t+(e-xe(t,e));function Ae(t,e,n,r){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(Re(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${Re(e,n)}`);let o=0,s=0;const i=2**n-1,a=[];for(const r of t){if(ye(r),r>=2**e)throw new Error(`convertRadix2: invalid data word=${r} from=${e}`);if(o=o<<e|r,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=n;s-=n)a.push((o>>s-n&i)>>>0);o&=2**s-1}if(o=o<<n-s&i,!r&&s>=e)throw new Error("Excess padding");if(!r&&o)throw new Error(`Non-zero padding: ${o}`);return r&&s>0&&a.push(o>>>0),a}function ke(t,e=!1){if(ye(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(Re(8,t)>32||Re(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return Ae(Array.from(n),8,t,!e)},decode:n=>{if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(Ae(n,t,8,e))}}}function Se(t){if("function"!=typeof t)throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch(t){}}}ge(ke(4),we("0123456789ABCDEF"),me("")),ge(ke(5),we("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),be(5),me(""));const _e=(ge(ke(5),we("0123456789ABCDEFGHIJKLMNOPQRSTUV"),be(5),me("")),ge(ke(5),we("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),me(""),ve((t=>t.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")))),ge(ke(6),we("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),be(6),me(""))),Oe=(ge(ke(6),we("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),be(6),me("")),t=>{return ge((ye(e=58),{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return Ee(Array.from(t),256,e)},decode:t=>{if(!Array.isArray(t)||t.length&&"number"!=typeof t[0])throw new Error("radix.decode input should be array of strings");return Uint8Array.from(Ee(t,e,256))}}),we(t),me(""));var e}),Le=(Oe("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),Oe("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),Oe("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz"),ge(we("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),me(""))),Ie=[996825010,642813549,513874426,1027748829,705979059];function Ue(t){const e=t>>25;let n=(33554431&t)<<5;for(let t=0;t<Ie.length;t++)1==(e>>t&1)&&(n^=Ie[t]);return n}function Ne(t,e,n=1){const r=t.length;let o=1;for(let e=0;e<r;e++){const n=t.charCodeAt(e);if(n<33||n>126)throw new Error(`Invalid prefix (${t})`);o=Ue(o)^n>>5}o=Ue(o);for(let e=0;e<r;e++)o=Ue(o)^31&t.charCodeAt(e);for(let t of e)o=Ue(o)^t;for(let t=0;t<6;t++)o=Ue(o);return o^=n,Le.encode(Ae([o%2**30],30,5,!1))}function Te(t){const e="bech32"===t?1:734539939,n=ke(5),r=n.decode,o=n.encode,s=Se(r);function i(t,n=90){if("string"!=typeof t)throw new Error("bech32.decode input should be string, not "+typeof t);if(t.length<8||!1!==n&&t.length>n)throw new TypeError(`Wrong string length: ${t.length} (${t}). Expected (8..${n})`);const r=t.toLowerCase();if(t!==r&&t!==t.toUpperCase())throw new Error("String must be lowercase or uppercase");const o=(t=r).lastIndexOf("1");if(0===o||-1===o)throw new Error('Letter "1" must be present between prefix and data only');const s=t.slice(0,o),i=t.slice(o+1);if(i.length<6)throw new Error("Data must be at least 6 characters long");const a=Le.decode(i).slice(0,-6),c=Ne(s,a,e);if(!i.endsWith(c))throw new Error(`Invalid checksum in ${t}: expected "${c}"`);return{prefix:s,words:a}}return{encode:function(t,n,r=90){if("string"!=typeof t)throw new Error("bech32.encode prefix should be string, not "+typeof t);if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("bech32.encode words should be array of numbers, not "+typeof n);const o=t.length+7+n.length;if(!1!==r&&o>r)throw new TypeError(`Length ${o} exceeds limit ${r}`);return`${t=t.toLowerCase()}1${Le.encode(n)}${Ne(t,n,e)}`},decode:i,decodeToBytes:function(t){const{prefix:e,words:n}=i(t,!1);return{prefix:e,words:n,bytes:r(n)}},decodeUnsafe:Se(i),fromWords:r,fromWordsUnsafe:s,toWords:o}}const Be=Te("bech32");Te("bech32m");function Pe(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`positive integer expected, not ${t}`)}function $e(t){if("boolean"!=typeof t)throw new Error(`boolean expected, not ${t}`)}function je(t){return t instanceof Uint8Array||null!=t&&"object"==typeof t&&"Uint8Array"===t.constructor.name}function Ce(t,...e){if(!je(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}function He(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Me(t,e){Ce(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}ge(ke(4),we("0123456789abcdef"),me(""),ve((t=>{if("string"!=typeof t||t.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof t} with length ${t.length}`);return t.toLowerCase()})));const qe=t=>new Uint8Array(t.buffer,t.byteOffset,t.byteLength),ze=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),We=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);if(68!==new Uint8Array(new Uint32Array([287454020]).buffer)[0])throw new Error("Non little-endian hardware is not supported");function De(t){if("string"==typeof t)t=function(t){if("string"!=typeof t)throw new Error("string expected, got "+typeof t);return new Uint8Array((new TextEncoder).encode(t))}(t);else{if(!je(t))throw new Error("Uint8Array expected, got "+typeof t);t=t.slice()}return t}function Ke(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return 0===n}const Fe=(t,e)=>(Object.assign(e,t),e);function Ve(t,e,n,r){if("function"==typeof t.setBigUint64)return t.setBigUint64(e,n,r);const o=BigInt(32),s=BigInt(4294967295),i=Number(n>>o&s),a=Number(n&s),c=r?4:0,l=r?0:4;t.setUint32(e+c,i,r),t.setUint32(e+l,a,r)}const Ze=16,Ge=new Uint8Array(16),Je=ze(Ge),Ye=t=>(t>>>0&255)<<24|(t>>>8&255)<<16|(t>>>16&255)<<8|t>>>24&255;class Qe{constructor(t,e){this.blockLen=Ze,this.outputLen=Ze,this.s0=0,this.s1=0,this.s2=0,this.s3=0,this.finished=!1,Ce(t=De(t),16);const n=We(t);let r=n.getUint32(0,!1),o=n.getUint32(4,!1),s=n.getUint32(8,!1),i=n.getUint32(12,!1);const a=[];for(let t=0;t<128;t++)a.push({s0:Ye(r),s1:Ye(o),s2:Ye(s),s3:Ye(i)}),({s0:r,s1:o,s2:s,s3:i}={s3:(u=s)<<31|(f=i)>>>1,s2:(l=o)<<31|u>>>1,s1:(c=r)<<31|l>>>1,s0:c>>>1^225<<24&-(1&f)});var c,l,u,f;const h=(t=>t>65536?8:t>1024?4:2)(e||1024);if(![1,2,4,8].includes(h))throw new Error(`ghash: wrong window size=${h}, should be 2, 4 or 8`);this.W=h;const d=128/h,p=this.windowSize=2**h,y=[];for(let t=0;t<d;t++)for(let e=0;e<p;e++){let n=0,r=0,o=0,s=0;for(let i=0;i<h;i++){if(!(e>>>h-i-1&1))continue;const{s0:c,s1:l,s2:u,s3:f}=a[h*t+i];n^=c,r^=l,o^=u,s^=f}y.push({s0:n,s1:r,s2:o,s3:s})}this.t=y}_updateBlock(t,e,n,r){t^=this.s0,e^=this.s1,n^=this.s2,r^=this.s3;const{W:o,t:s,windowSize:i}=this;let a=0,c=0,l=0,u=0;const f=(1<<o)-1;let h=0;for(const d of[t,e,n,r])for(let t=0;t<4;t++){const e=d>>>8*t&255;for(let t=8/o-1;t>=0;t--){const n=e>>>o*t&f,{s0:r,s1:d,s2:p,s3:y}=s[h*i+n];a^=r,c^=d,l^=p,u^=y,h+=1}}this.s0=a,this.s1=c,this.s2=l,this.s3=u}update(t){t=De(t),He(this);const e=ze(t),n=Math.floor(t.length/Ze),r=t.length%Ze;for(let t=0;t<n;t++)this._updateBlock(e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]);return r&&(Ge.set(t.subarray(n*Ze)),this._updateBlock(Je[0],Je[1],Je[2],Je[3]),Je.fill(0)),this}destroy(){const{t}=this;for(const e of t)e.s0=0,e.s1=0,e.s2=0,e.s3=0}digestInto(t){He(this),Me(t,this),this.finished=!0;const{s0:e,s1:n,s2:r,s3:o}=this,s=ze(t);return s[0]=e,s[1]=n,s[2]=r,s[3]=o,t}digest(){const t=new Uint8Array(Ze);return this.digestInto(t),this.destroy(),t}}class Xe extends Qe{constructor(t,e){const n=function(t){t.reverse();const e=1&t[15];let n=0;for(let e=0;e<t.length;e++){const r=t[e];t[e]=r>>>1|n,n=(1&r)<<7}return t[0]^=225&-e,t}((t=De(t)).slice());super(n,e),n.fill(0)}update(t){t=De(t),He(this);const e=ze(t),n=t.length%Ze,r=Math.floor(t.length/Ze);for(let t=0;t<r;t++)this._updateBlock(Ye(e[4*t+3]),Ye(e[4*t+2]),Ye(e[4*t+1]),Ye(e[4*t+0]));return n&&(Ge.set(t.subarray(r*Ze)),this._updateBlock(Ye(Je[3]),Ye(Je[2]),Ye(Je[1]),Ye(Je[0])),Je.fill(0)),this}digestInto(t){He(this),Me(t,this),this.finished=!0;const{s0:e,s1:n,s2:r,s3:o}=this,s=ze(t);return s[0]=e,s[1]=n,s[2]=r,s[3]=o,t.reverse()}}function tn(t){const e=(e,n)=>t(n,e.length).update(De(e)).digest(),n=t(new Uint8Array(16),0);return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=(e,n)=>t(e,n),e}const en=tn(((t,e)=>new Qe(t,e))),nn=tn(((t,e)=>new Xe(t,e))),rn=16,on=new Uint8Array(rn);function sn(t){return t<<1^283&-(t>>7)}function an(t,e){let n=0;for(;e>0;e>>=1)n^=t&-(1&e),t=sn(t);return n}const cn=(()=>{let t=new Uint8Array(256);for(let e=0,n=1;e<256;e++,n^=sn(n))t[e]=n;const e=new Uint8Array(256);e[0]=99;for(let n=0;n<255;n++){let r=t[255-n];r|=r<<8,e[t[n]]=255&(r^r>>4^r>>5^r>>6^r>>7^99)}return e})(),ln=cn.map(((t,e)=>cn.indexOf(e))),un=t=>t<<8|t>>>24;function fn(t,e){if(256!==t.length)throw new Error("Wrong sbox length");const n=new Uint32Array(256).map(((n,r)=>e(t[r]))),r=n.map(un),o=r.map(un),s=o.map(un),i=new Uint32Array(65536),a=new Uint32Array(65536),c=new Uint16Array(65536);for(let e=0;e<256;e++)for(let l=0;l<256;l++){const u=256*e+l;i[u]=n[e]^r[l],a[u]=o[e]^s[l],c[u]=t[e]<<8|t[l]}return{sbox:t,sbox2:c,T0:n,T1:r,T2:o,T3:s,T01:i,T23:a}}const hn=fn(cn,(t=>an(t,3)<<24|t<<16|t<<8|an(t,2))),dn=fn(ln,(t=>an(t,11)<<24|an(t,13)<<16|an(t,9)<<8|an(t,14))),pn=(()=>{const t=new Uint8Array(16);for(let e=0,n=1;e<16;e++,n=sn(n))t[e]=n;return t})();function yn(t){Ce(t);const e=t.length;if(![16,24,32].includes(e))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${e}`);const{sbox2:n}=hn,r=ze(t),o=r.length,s=t=>mn(n,t,t,t,t),i=new Uint32Array(e+28);i.set(r);for(let t=o;t<i.length;t++){let e=i[t-1];t%o==0?e=s((a=e)<<24|a>>>8)^pn[t/o-1]:o>6&&t%o==4&&(e=s(e)),i[t]=i[t-o]^e}var a;return i}function gn(t){const e=yn(t),n=e.slice(),r=e.length,{sbox2:o}=hn,{T0:s,T1:i,T2:a,T3:c}=dn;for(let t=0;t<r;t+=4)for(let o=0;o<4;o++)n[t+o]=e[r-t-4+o];e.fill(0);for(let t=4;t<r-4;t++){const e=n[t],r=mn(o,e,e,e,e);n[t]=s[255&r]^i[r>>>8&255]^a[r>>>16&255]^c[r>>>24]}return n}function wn(t,e,n,r,o,s){return t[n<<8&65280|r>>>8&255]^e[o>>>8&65280|s>>>24&255]}function mn(t,e,n,r,o){return t[255&e|65280&n]|t[r>>>16&255|o>>>16&65280]<<16}function bn(t,e,n,r,o){const{sbox2:s,T01:i,T23:a}=hn;let c=0;e^=t[c++],n^=t[c++],r^=t[c++],o^=t[c++];const l=t.length/4-2;for(let s=0;s<l;s++){const s=t[c++]^wn(i,a,e,n,r,o),l=t[c++]^wn(i,a,n,r,o,e),u=t[c++]^wn(i,a,r,o,e,n),f=t[c++]^wn(i,a,o,e,n,r);e=s,n=l,r=u,o=f}return{s0:t[c++]^mn(s,e,n,r,o),s1:t[c++]^mn(s,n,r,o,e),s2:t[c++]^mn(s,r,o,e,n),s3:t[c++]^mn(s,o,e,n,r)}}function vn(t,e,n,r,o){const{sbox2:s,T01:i,T23:a}=dn;let c=0;e^=t[c++],n^=t[c++],r^=t[c++],o^=t[c++];const l=t.length/4-2;for(let s=0;s<l;s++){const s=t[c++]^wn(i,a,e,o,r,n),l=t[c++]^wn(i,a,n,e,o,r),u=t[c++]^wn(i,a,r,n,e,o),f=t[c++]^wn(i,a,o,r,n,e);e=s,n=l,r=u,o=f}return{s0:t[c++]^mn(s,e,o,r,n),s1:t[c++]^mn(s,n,e,o,r),s2:t[c++]^mn(s,r,n,e,o),s3:t[c++]^mn(s,o,r,n,e)}}function En(t,e){if(!e)return new Uint8Array(t);if(Ce(e),e.length<t)throw new Error(`aes: wrong destination length, expected at least ${t}, got: ${e.length}`);return e}function xn(t,e,n,r,o){Ce(n,rn),Ce(r),o=En(r.length,o);const s=n,i=ze(s),a=We(s),c=ze(r),l=ze(o),u=e?0:12,f=r.length;let h=a.getUint32(u,e),{s0:d,s1:p,s2:y,s3:g}=bn(t,i[0],i[1],i[2],i[3]);for(let n=0;n+4<=c.length;n+=4)l[n+0]=c[n+0]^d,l[n+1]=c[n+1]^p,l[n+2]=c[n+2]^y,l[n+3]=c[n+3]^g,h=h+1>>>0,a.setUint32(u,h,e),({s0:d,s1:p,s2:y,s3:g}=bn(t,i[0],i[1],i[2],i[3]));const w=rn*Math.floor(c.length/4);if(w<f){const t=new Uint32Array([d,p,y,g]),e=qe(t);for(let t=w,n=0;t<f;t++,n++)o[t]=r[t]^e[n]}return o}function Rn(t){if(Ce(t),t.length%rn!=0)throw new Error("aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size 16")}function An(t,e,n){let r=t.length;const o=r%rn;if(!e&&0!==o)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const s=ze(t);if(e){let t=rn-o;t||(t=rn),r+=t}const i=En(r,n);return{b:s,o:ze(i),out:i}}function kn(t,e){if(!e)return t;const n=t.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");const r=t[n-1];if(r<=0||r>16)throw new Error(`aes/pcks5: wrong padding byte: ${r}`);const o=t.subarray(0,-r);for(let e=0;e<r;e++)if(t[n-e-1]!==r)throw new Error("aes/pcks5: wrong padding");return o}function Sn(t){const e=new Uint8Array(16),n=ze(e);e.set(t);const r=rn-t.length;for(let t=rn-r;t<rn;t++)e[t]=r;return n}Fe({blockSize:16,nonceLength:16},(function(t,e){function n(n,r){const o=yn(t),s=e.slice(),i=function(t,e,n,r){Ce(e,rn),Ce(n);const o=n.length;r=En(o,r);const s=e,i=ze(s);let{s0:a,s1:c,s2:l,s3:u}=bn(t,i[0],i[1],i[2],i[3]);const f=ze(n),h=ze(r);for(let e=0;e+4<=f.length;e+=4){h[e+0]=f[e+0]^a,h[e+1]=f[e+1]^c,h[e+2]=f[e+2]^l,h[e+3]=f[e+3]^u;let n=1;for(let t=s.length-1;t>=0;t--)n=n+(255&s[t])|0,s[t]=255&n,n>>>=8;({s0:a,s1:c,s2:l,s3:u}=bn(t,i[0],i[1],i[2],i[3]))}const d=rn*Math.floor(f.length/4);if(d<o){const t=new Uint32Array([a,c,l,u]),e=qe(t);for(let t=d,s=0;t<o;t++,s++)r[t]=n[t]^e[s]}return r}(o,s,n,r);return o.fill(0),s.fill(0),i}return Ce(t),Ce(e,rn),{encrypt:(t,e)=>n(t,e),decrypt:(t,e)=>n(t,e)}})),Fe({blockSize:16},(function(t,e={}){Ce(t);const n=!e.disablePadding;return{encrypt:(e,r)=>{Ce(e);const{b:o,o:s,out:i}=An(e,n,r),a=yn(t);let c=0;for(;c+4<=o.length;){const{s0:t,s1:e,s2:n,s3:r}=bn(a,o[c+0],o[c+1],o[c+2],o[c+3]);s[c++]=t,s[c++]=e,s[c++]=n,s[c++]=r}if(n){const t=Sn(e.subarray(4*c)),{s0:n,s1:r,s2:o,s3:i}=bn(a,t[0],t[1],t[2],t[3]);s[c++]=n,s[c++]=r,s[c++]=o,s[c++]=i}return a.fill(0),i},decrypt:(e,r)=>{Rn(e);const o=gn(t),s=En(e.length,r),i=ze(e),a=ze(s);for(let t=0;t+4<=i.length;){const{s0:e,s1:n,s2:r,s3:s}=vn(o,i[t+0],i[t+1],i[t+2],i[t+3]);a[t++]=e,a[t++]=n,a[t++]=r,a[t++]=s}return o.fill(0),kn(s,n)}}}));const _n=Fe({blockSize:16,nonceLength:16},(function(t,e,n={}){Ce(t),Ce(e,16);const r=!n.disablePadding;return{encrypt:(n,o)=>{const s=yn(t),{b:i,o:a,out:c}=An(n,r,o),l=ze(e);let u=l[0],f=l[1],h=l[2],d=l[3],p=0;for(;p+4<=i.length;)u^=i[p+0],f^=i[p+1],h^=i[p+2],d^=i[p+3],({s0:u,s1:f,s2:h,s3:d}=bn(s,u,f,h,d)),a[p++]=u,a[p++]=f,a[p++]=h,a[p++]=d;if(r){const t=Sn(n.subarray(4*p));u^=t[0],f^=t[1],h^=t[2],d^=t[3],({s0:u,s1:f,s2:h,s3:d}=bn(s,u,f,h,d)),a[p++]=u,a[p++]=f,a[p++]=h,a[p++]=d}return s.fill(0),c},decrypt:(n,o)=>{Rn(n);const s=gn(t),i=ze(e),a=En(n.length,o),c=ze(n),l=ze(a);let u=i[0],f=i[1],h=i[2],d=i[3];for(let t=0;t+4<=c.length;){const e=u,n=f,r=h,o=d;u=c[t+0],f=c[t+1],h=c[t+2],d=c[t+3];const{s0:i,s1:a,s2:p,s3:y}=vn(s,u,f,h,d);l[t++]=i^e,l[t++]=a^n,l[t++]=p^r,l[t++]=y^o}return s.fill(0),kn(a,r)}}}));function On(t,e,n,r,o){const s=t.create(n,r.length+(o?.length||0));o&&s.update(o),s.update(r);const i=new Uint8Array(16),a=We(i);return o&&Ve(a,0,BigInt(8*o.length),e),Ve(a,8,BigInt(8*r.length),e),s.update(i),s.digest()}Fe({blockSize:16,nonceLength:16},(function(t,e){function n(n,r,o){const s=yn(t),i=n.length;o=En(i,o);const a=ze(n),c=ze(o),l=r?c:a,u=ze(e);let f=u[0],h=u[1],d=u[2],p=u[3];for(let t=0;t+4<=a.length;){const{s0:e,s1:n,s2:r,s3:o}=bn(s,f,h,d,p);c[t+0]=a[t+0]^e,c[t+1]=a[t+1]^n,c[t+2]=a[t+2]^r,c[t+3]=a[t+3]^o,f=l[t++],h=l[t++],d=l[t++],p=l[t++]}const y=rn*Math.floor(a.length/4);if(y<i){({s0:f,s1:h,s2:d,s3:p}=bn(s,f,h,d,p));const t=qe(new Uint32Array([f,h,d,p]));for(let e=y,r=0;e<i;e++,r++)o[e]=n[e]^t[r];t.fill(0)}return s.fill(0),o}return Ce(t),Ce(e,16),{encrypt:(t,e)=>n(t,!0,e),decrypt:(t,e)=>n(t,!1,e)}})),Fe({blockSize:16,nonceLength:12,tagLength:16},(function(t,e,n){if(Ce(e),0===e.length)throw new Error("aes/gcm: empty nonce");function r(t,e,r){const o=On(en,!1,t,r,n);for(let t=0;t<e.length;t++)o[t]^=e[t];return o}function o(){const n=yn(t),r=on.slice(),o=on.slice();if(xn(n,!1,o,o,r),12===e.length)o.set(e);else{const t=on.slice();Ve(We(t),8,BigInt(8*e.length),!1),en.create(r).update(e).update(t).digestInto(o)}return{xk:n,authKey:r,counter:o,tagMask:xn(n,!1,o,on)}}return{encrypt:t=>{Ce(t);const{xk:e,authKey:n,counter:s,tagMask:i}=o(),a=new Uint8Array(t.length+16);xn(e,!1,s,t,a);const c=r(n,i,a.subarray(0,a.length-16));return a.set(c,t.length),e.fill(0),a},decrypt:t=>{if(Ce(t),t.length<16)throw new Error("aes/gcm: ciphertext less than tagLen (16)");const{xk:e,authKey:n,counter:s,tagMask:i}=o(),a=t.subarray(0,-16),c=t.subarray(-16);if(!Ke(r(n,i,a),c))throw new Error("aes/gcm: invalid ghash tag");const l=xn(e,!1,s,a);return n.fill(0),i.fill(0),e.fill(0),l}}}));const Ln=(t,e,n)=>r=>{if(!Number.isSafeInteger(r)||e>r||r>n)throw new Error(`${t}: invalid value=${r}, must be [${e}..${n}]`)};Fe({blockSize:16,nonceLength:12,tagLength:16},(function(t,e,n){const r=Ln("AAD",0,2**36),o=Ln("plaintext",0,2**36),s=Ln("nonce",12,12),i=Ln("ciphertext",16,2**36+16);function a(){const n=t.length;if(16!==n&&24!==n&&32!==n)throw new Error(`key length must be 16, 24 or 32 bytes, got: ${n} bytes`);const r=yn(t),o=new Uint8Array(n),s=new Uint8Array(16),i=ze(e);let a=0,c=i[0],l=i[1],u=i[2],f=0;for(const t of[s,o].map(ze)){const e=ze(t);for(let t=0;t<e.length;t+=2){const{s0:n,s1:o}=bn(r,a,c,l,u);e[t+0]=n,e[t+1]=o,a=++f}}return r.fill(0),{authKey:s,encKey:yn(o)}}function c(t,r,o){const s=On(nn,!0,r,o,n);for(let t=0;t<12;t++)s[t]^=e[t];s[15]&=127;const i=ze(s);let a=i[0],c=i[1],l=i[2],u=i[3];return({s0:a,s1:c,s2:l,s3:u}=bn(t,a,c,l,u)),i[0]=a,i[1]=c,i[2]=l,i[3]=u,s}function l(t,e,n){let r=e.slice();return r[15]|=128,xn(t,!0,r,n)}return Ce(e),s(e.length),n&&(Ce(n),r(n.length)),{encrypt:t=>{Ce(t),o(t.length);const{encKey:e,authKey:n}=a(),r=c(e,n,t),s=new Uint8Array(t.length+16);return s.set(r,t.length),s.set(l(e,r,t)),e.fill(0),n.fill(0),s},decrypt:t=>{Ce(t),i(t.length);const e=t.subarray(-16),{encKey:n,authKey:r}=a(),o=l(n,e,t.subarray(0,-16)),s=c(n,r,o);if(n.fill(0),r.fill(0),!Ke(e,s))throw new Error("invalid polyval tag");return o}}}));const In=(t,e)=>255&t[e++]|(255&t[e++])<<8;class Un{constructor(t){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,Ce(t=De(t),32);const e=In(t,0),n=In(t,2),r=In(t,4),o=In(t,6),s=In(t,8),i=In(t,10),a=In(t,12),c=In(t,14);this.r[0]=8191&e,this.r[1]=8191&(e>>>13|n<<3),this.r[2]=7939&(n>>>10|r<<6),this.r[3]=8191&(r>>>7|o<<9),this.r[4]=255&(o>>>4|s<<12),this.r[5]=s>>>1&8190,this.r[6]=8191&(s>>>14|i<<2),this.r[7]=8065&(i>>>11|a<<5),this.r[8]=8191&(a>>>8|c<<8),this.r[9]=c>>>5&127;for(let e=0;e<8;e++)this.pad[e]=In(t,16+2*e)}process(t,e,n=!1){const r=n?0:2048,{h:o,r:s}=this,i=s[0],a=s[1],c=s[2],l=s[3],u=s[4],f=s[5],h=s[6],d=s[7],p=s[8],y=s[9],g=In(t,e+0),w=In(t,e+2),m=In(t,e+4),b=In(t,e+6),v=In(t,e+8),E=In(t,e+10),x=In(t,e+12),R=In(t,e+14);let A=o[0]+(8191&g),k=o[1]+(8191&(g>>>13|w<<3)),S=o[2]+(8191&(w>>>10|m<<6)),_=o[3]+(8191&(m>>>7|b<<9)),O=o[4]+(8191&(b>>>4|v<<12)),L=o[5]+(v>>>1&8191),I=o[6]+(8191&(v>>>14|E<<2)),U=o[7]+(8191&(E>>>11|x<<5)),N=o[8]+(8191&(x>>>8|R<<8)),T=o[9]+(R>>>5|r),B=0,P=B+A*i+k*(5*y)+S*(5*p)+_*(5*d)+O*(5*h);B=P>>>13,P&=8191,P+=L*(5*f)+I*(5*u)+U*(5*l)+N*(5*c)+T*(5*a),B+=P>>>13,P&=8191;let $=B+A*a+k*i+S*(5*y)+_*(5*p)+O*(5*d);B=$>>>13,$&=8191,$+=L*(5*h)+I*(5*f)+U*(5*u)+N*(5*l)+T*(5*c),B+=$>>>13,$&=8191;let j=B+A*c+k*a+S*i+_*(5*y)+O*(5*p);B=j>>>13,j&=8191,j+=L*(5*d)+I*(5*h)+U*(5*f)+N*(5*u)+T*(5*l),B+=j>>>13,j&=8191;let C=B+A*l+k*c+S*a+_*i+O*(5*y);B=C>>>13,C&=8191,C+=L*(5*p)+I*(5*d)+U*(5*h)+N*(5*f)+T*(5*u),B+=C>>>13,C&=8191;let H=B+A*u+k*l+S*c+_*a+O*i;B=H>>>13,H&=8191,H+=L*(5*y)+I*(5*p)+U*(5*d)+N*(5*h)+T*(5*f),B+=H>>>13,H&=8191;let M=B+A*f+k*u+S*l+_*c+O*a;B=M>>>13,M&=8191,M+=L*i+I*(5*y)+U*(5*p)+N*(5*d)+T*(5*h),B+=M>>>13,M&=8191;let q=B+A*h+k*f+S*u+_*l+O*c;B=q>>>13,q&=8191,q+=L*a+I*i+U*(5*y)+N*(5*p)+T*(5*d),B+=q>>>13,q&=8191;let z=B+A*d+k*h+S*f+_*u+O*l;B=z>>>13,z&=8191,z+=L*c+I*a+U*i+N*(5*y)+T*(5*p),B+=z>>>13,z&=8191;let W=B+A*p+k*d+S*h+_*f+O*u;B=W>>>13,W&=8191,W+=L*l+I*c+U*a+N*i+T*(5*y),B+=W>>>13,W&=8191;let D=B+A*y+k*p+S*d+_*h+O*f;B=D>>>13,D&=8191,D+=L*u+I*l+U*c+N*a+T*i,B+=D>>>13,D&=8191,B=(B<<2)+B|0,B=B+P|0,P=8191&B,B>>>=13,$+=B,o[0]=P,o[1]=$,o[2]=j,o[3]=C,o[4]=H,o[5]=M,o[6]=q,o[7]=z,o[8]=W,o[9]=D}finalize(){const{h:t,pad:e}=this,n=new Uint16Array(10);let r=t[1]>>>13;t[1]&=8191;for(let e=2;e<10;e++)t[e]+=r,r=t[e]>>>13,t[e]&=8191;t[0]+=5*r,r=t[0]>>>13,t[0]&=8191,t[1]+=r,r=t[1]>>>13,t[1]&=8191,t[2]+=r,n[0]=t[0]+5,r=n[0]>>>13,n[0]&=8191;for(let e=1;e<10;e++)n[e]=t[e]+r,r=n[e]>>>13,n[e]&=8191;n[9]-=8192;let o=(1^r)-1;for(let t=0;t<10;t++)n[t]&=o;o=~o;for(let e=0;e<10;e++)t[e]=t[e]&o|n[e];t[0]=65535&(t[0]|t[1]<<13),t[1]=65535&(t[1]>>>3|t[2]<<10),t[2]=65535&(t[2]>>>6|t[3]<<7),t[3]=65535&(t[3]>>>9|t[4]<<4),t[4]=65535&(t[4]>>>12|t[5]<<1|t[6]<<14),t[5]=65535&(t[6]>>>2|t[7]<<11),t[6]=65535&(t[7]>>>5|t[8]<<8),t[7]=65535&(t[8]>>>8|t[9]<<5);let s=t[0]+e[0];t[0]=65535&s;for(let n=1;n<8;n++)s=(t[n]+e[n]|0)+(s>>>16)|0,t[n]=65535&s}update(t){He(this);const{buffer:e,blockLen:n}=this,r=(t=De(t)).length;for(let o=0;o<r;){const s=Math.min(n-this.pos,r-o);if(s!==n)e.set(t.subarray(o,o+s),this.pos),this.pos+=s,o+=s,this.pos===n&&(this.process(e,0,!1),this.pos=0);else for(;n<=r-o;o+=n)this.process(t,o)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(t){He(this),Me(t,this),this.finished=!0;const{buffer:e,h:n}=this;let{pos:r}=this;if(r){for(e[r++]=1;r<16;r++)e[r]=0;this.process(e,0,!0)}this.finalize();let o=0;for(let e=0;e<8;e++)t[o++]=n[e]>>>0,t[o++]=n[e]>>>8;return t}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const n=t.slice(0,e);return this.destroy(),n}}const Nn=function(t){const e=(e,n)=>t(n).update(De(e)).digest(),n=t(new Uint8Array(32));return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=e=>t(e),e}((t=>new Un(t))),Tn=t=>Uint8Array.from(t.split("").map((t=>t.charCodeAt(0)))),Bn=Tn("expand 16-byte k"),Pn=Tn("expand 32-byte k"),$n=ze(Bn),jn=ze(Pn);function Cn(t,e){return t<<e|t>>>32-e}function Hn(t){return t.byteOffset%4==0}jn.slice();const Mn=2**32-1,qn=new Uint32Array;function zn(t,e){const{allowShortKeys:n,extendNonceFn:r,counterLength:o,counterRight:s,rounds:i}=function(t,e){if(null==e||"object"!=typeof e)throw new Error("options must be defined");return Object.assign({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e)}(0,e);if("function"!=typeof t)throw new Error("core must be a function");return Pe(o),Pe(i),$e(s),$e(n),(e,a,c,l,u=0)=>{Ce(e),Ce(a),Ce(c);const f=c.length;if(l||(l=new Uint8Array(f)),Ce(l),Pe(u),u<0||u>=Mn)throw new Error("arx: counter overflow");if(l.length<f)throw new Error(`arx: output (${l.length}) is shorter than data (${f})`);const h=[];let d,p,y=e.length;if(32===y)d=e.slice(),h.push(d),p=jn;else{if(16!==y||!n)throw new Error(`arx: invalid 32-byte key, got length=${y}`);d=new Uint8Array(32),d.set(e),d.set(e,16),p=$n,h.push(d)}Hn(a)||(a=a.slice(),h.push(a));const g=ze(d);if(r){if(24!==a.length)throw new Error("arx: extended nonce must be 24 bytes");r(p,g,ze(a.subarray(0,16)),g),a=a.subarray(16)}const w=16-o;if(w!==a.length)throw new Error(`arx: nonce must be ${w} or 16 bytes`);if(12!==w){const t=new Uint8Array(12);t.set(a,s?0:12-a.length),a=t,h.push(a)}const m=ze(a);for(function(t,e,n,r,o,s,i,a){const c=o.length,l=new Uint8Array(64),u=ze(l),f=Hn(o)&&Hn(s),h=f?ze(o):qn,d=f?ze(s):qn;for(let p=0;p<c;i++){if(t(e,n,r,u,i,a),i>=Mn)throw new Error("arx: counter overflow");const y=Math.min(64,c-p);if(f&&64===y){const t=p/4;if(p%4!=0)throw new Error("arx: invalid block position");for(let e,n=0;n<16;n++)e=t+n,d[e]=h[e]^u[n];p+=64}else{for(let t,e=0;e<y;e++)t=p+e,s[t]=o[t]^l[e];p+=y}}}(t,p,g,m,c,l,u,i);h.length>0;)h.pop().fill(0);return l}}function Wn(t,e,n,r,o,s=20){let i=t[0],a=t[1],c=t[2],l=t[3],u=e[0],f=e[1],h=e[2],d=e[3],p=e[4],y=e[5],g=e[6],w=e[7],m=o,b=n[0],v=n[1],E=n[2],x=i,R=a,A=c,k=l,S=u,_=f,O=h,L=d,I=p,U=y,N=g,T=w,B=m,P=b,$=v,j=E;for(let t=0;t<s;t+=2)x=x+S|0,B=Cn(B^x,16),I=I+B|0,S=Cn(S^I,12),x=x+S|0,B=Cn(B^x,8),I=I+B|0,S=Cn(S^I,7),R=R+_|0,P=Cn(P^R,16),U=U+P|0,_=Cn(_^U,12),R=R+_|0,P=Cn(P^R,8),U=U+P|0,_=Cn(_^U,7),A=A+O|0,$=Cn($^A,16),N=N+$|0,O=Cn(O^N,12),A=A+O|0,$=Cn($^A,8),N=N+$|0,O=Cn(O^N,7),k=k+L|0,j=Cn(j^k,16),T=T+j|0,L=Cn(L^T,12),k=k+L|0,j=Cn(j^k,8),T=T+j|0,L=Cn(L^T,7),x=x+_|0,j=Cn(j^x,16),N=N+j|0,_=Cn(_^N,12),x=x+_|0,j=Cn(j^x,8),N=N+j|0,_=Cn(_^N,7),R=R+O|0,B=Cn(B^R,16),T=T+B|0,O=Cn(O^T,12),R=R+O|0,B=Cn(B^R,8),T=T+B|0,O=Cn(O^T,7),A=A+L|0,P=Cn(P^A,16),I=I+P|0,L=Cn(L^I,12),A=A+L|0,P=Cn(P^A,8),I=I+P|0,L=Cn(L^I,7),k=k+S|0,$=Cn($^k,16),U=U+$|0,S=Cn(S^U,12),k=k+S|0,$=Cn($^k,8),U=U+$|0,S=Cn(S^U,7);let C=0;r[C++]=i+x|0,r[C++]=a+R|0,r[C++]=c+A|0,r[C++]=l+k|0,r[C++]=u+S|0,r[C++]=f+_|0,r[C++]=h+O|0,r[C++]=d+L|0,r[C++]=p+I|0,r[C++]=y+U|0,r[C++]=g+N|0,r[C++]=w+T|0,r[C++]=m+B|0,r[C++]=b+P|0,r[C++]=v+$|0,r[C++]=E+j|0}const Dn=zn(Wn,{counterRight:!1,counterLength:4,allowShortKeys:!1}),Kn=zn(Wn,{counterRight:!1,counterLength:8,extendNonceFn:function(t,e,n,r){let o=t[0],s=t[1],i=t[2],a=t[3],c=e[0],l=e[1],u=e[2],f=e[3],h=e[4],d=e[5],p=e[6],y=e[7],g=n[0],w=n[1],m=n[2],b=n[3];for(let t=0;t<20;t+=2)o=o+c|0,g=Cn(g^o,16),h=h+g|0,c=Cn(c^h,12),o=o+c|0,g=Cn(g^o,8),h=h+g|0,c=Cn(c^h,7),s=s+l|0,w=Cn(w^s,16),d=d+w|0,l=Cn(l^d,12),s=s+l|0,w=Cn(w^s,8),d=d+w|0,l=Cn(l^d,7),i=i+u|0,m=Cn(m^i,16),p=p+m|0,u=Cn(u^p,12),i=i+u|0,m=Cn(m^i,8),p=p+m|0,u=Cn(u^p,7),a=a+f|0,b=Cn(b^a,16),y=y+b|0,f=Cn(f^y,12),a=a+f|0,b=Cn(b^a,8),y=y+b|0,f=Cn(f^y,7),o=o+l|0,b=Cn(b^o,16),p=p+b|0,l=Cn(l^p,12),o=o+l|0,b=Cn(b^o,8),p=p+b|0,l=Cn(l^p,7),s=s+u|0,g=Cn(g^s,16),y=y+g|0,u=Cn(u^y,12),s=s+u|0,g=Cn(g^s,8),y=y+g|0,u=Cn(u^y,7),i=i+f|0,w=Cn(w^i,16),h=h+w|0,f=Cn(f^h,12),i=i+f|0,w=Cn(w^i,8),h=h+w|0,f=Cn(f^h,7),a=a+c|0,m=Cn(m^a,16),d=d+m|0,c=Cn(c^d,12),a=a+c|0,m=Cn(m^a,8),d=d+m|0,c=Cn(c^d,7);let v=0;r[v++]=o,r[v++]=s,r[v++]=i,r[v++]=a,r[v++]=g,r[v++]=w,r[v++]=m,r[v++]=b},allowShortKeys:!1}),Fn=new Uint8Array(16),Vn=(t,e)=>{t.update(e);const n=e.length%16;n&&t.update(Fn.subarray(n))},Zn=new Uint8Array(32);function Gn(t,e,n,r,o){const s=t(e,n,Zn),i=Nn.create(s);o&&Vn(i,o),Vn(i,r);const a=new Uint8Array(16),c=We(a);Ve(c,0,BigInt(o?o.length:0),!0),Ve(c,8,BigInt(r.length),!0),i.update(a);const l=i.digest();return s.fill(0),l}const Jn=t=>(e,n,r)=>(Ce(e,32),Ce(n),{encrypt:(o,s)=>{const i=o.length,a=i+16;s?Ce(s,a):s=new Uint8Array(a),t(e,n,o,s,1);const c=Gn(t,e,n,s.subarray(0,-16),r);return s.set(c,i),s},decrypt:(o,s)=>{const i=o.length,a=i-16;if(i<16)throw new Error("encrypted data must be at least 16 bytes");s?Ce(s,a):s=new Uint8Array(a);const c=o.subarray(0,-16);if(!Ke(o.subarray(-16),Gn(t,e,n,c,r)))throw new Error("invalid tag");return t(e,n,c,s,1),s}});Jn(Dn),Jn(Kn);class Yn extends ee{constructor(t,e){super(),this.finished=!1,this.destroyed=!1,ie.hash(t);const n=Xt(e);if(this.iHash=t.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,o=new Uint8Array(r);o.set(n.length>r?t.create().update(n).digest():n);for(let t=0;t<o.length;t++)o[t]^=54;this.iHash.update(o),this.oHash=t.create();for(let t=0;t<o.length;t++)o[t]^=106;this.oHash.update(o),o.fill(0)}update(t){return ie.exists(this),this.iHash.update(t),this}digestInto(t){ie.exists(this),ie.bytes(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:e,iHash:n,finished:r,destroyed:o,blockLen:s,outputLen:i}=this;return t.finished=r,t.destroyed=o,t.blockLen=s,t.outputLen=i,t.oHash=e._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Qn=(t,e,n)=>new Yn(t,e).update(n).digest();Qn.create=(t,e)=>new Yn(t,e);const Xn=new Uint8Array([0]),tr=new Uint8Array;var er=Object.defineProperty,nr=(t,e)=>{for(var n in e)er(t,n,{get:e[n],enumerable:!0})},rr=Symbol("verified");function or(t){if(!(t instanceof Object))return!1;if("number"!=typeof t.kind)return!1;if("string"!=typeof t.content)return!1;if("number"!=typeof t.created_at)return!1;if("string"!=typeof t.pubkey)return!1;if(!t.pubkey.match(/^[a-f0-9]{64}$/))return!1;if(!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){let n=t.tags[e];if(!Array.isArray(n))return!1;for(let t=0;t<n.length;t++)if("object"==typeof n[t])return!1}return!0}nr({},{Queue:()=>hr,QueueNode:()=>fr,binarySearch:()=>ur,insertEventIntoAscendingList:()=>lr,insertEventIntoDescendingList:()=>cr,normalizeURL:()=>ar,utf8Decoder:()=>sr,utf8Encoder:()=>ir});var sr=new TextDecoder("utf-8"),ir=new TextEncoder;function ar(t){-1===t.indexOf("://")&&(t="wss://"+t);let e=new URL(t);return e.pathname=e.pathname.replace(/\/+/g,"/"),e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),("80"===e.port&&"ws:"===e.protocol||"443"===e.port&&"wss:"===e.protocol)&&(e.port=""),e.searchParams.sort(),e.hash="",e.toString()}function cr(t,e){const[n,r]=ur(t,(t=>e.id===t.id?0:e.created_at===t.created_at?-1:t.created_at-e.created_at));return r||t.splice(n,0,e),t}function lr(t,e){const[n,r]=ur(t,(t=>e.id===t.id?0:e.created_at===t.created_at?-1:e.created_at-t.created_at));return r||t.splice(n,0,e),t}function ur(t,e){let n=0,r=t.length-1;for(;n<=r;){const o=Math.floor((n+r)/2),s=e(t[o]);if(0===s)return[o,!0];s<0?r=o-1:n=o+1}return[n,!1]}var fr=class{value;next=null;prev=null;constructor(t){this.value=t}},hr=class{first;last;constructor(){this.first=null,this.last=null}enqueue(t){const e=new fr(t);return this.last?this.last===this.first?(this.last=e,this.last.prev=this.first,this.first.next=e):(e.prev=this.last,this.last.next=e,this.last=e):(this.first=e,this.last=e),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const t=this.first;return this.first=null,this.last=null,t.value}const t=this.first;return this.first=t.next,t.value}};function dr(t){return Yt(pe(ir.encode(function(t){if(!or(t))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content])}(t))))}var pr=new class{generateSecretKey(){return Kt.utils.randomPrivateKey()}getPublicKey(t){return Yt(Kt.getPublicKey(t))}finalizeEvent(t,e){const n=t;return n.pubkey=Yt(Kt.getPublicKey(e)),n.id=dr(n),n.sig=Yt(Kt.sign(dr(n),e)),n[rr]=!0,n}verifyEvent(t){if("boolean"==typeof t[rr])return t[rr];const e=dr(t);if(e!==t.id)return t[rr]=!1,!1;try{const n=Kt.verify(t.sig,e,t.pubkey);return t[rr]=n,n}catch(e){return t[rr]=!1,!1}}},yr=pr.generateSecretKey,gr=pr.getPublicKey,wr=pr.finalizeEvent,mr=pr.verifyEvent;function br(t){return 1e3<=t&&t<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(t)}function vr(t){return[0,3].includes(t)||1e4<=t&&t<2e4}function Er(t){return 2e4<=t&&t<3e4}function xr(t){return 3e4<=t&&t<4e4}nr({},{Application:()=>Co,BadgeAward:()=>Br,BadgeDefinition:()=>Uo,BlockedRelaysList:()=>fo,BookmarkList:()=>co,Bookmarksets:()=>Oo,Calendar:()=>Ko,CalendarEventRSVP:()=>Fo,ChannelCreation:()=>Cr,ChannelHideMessage:()=>qr,ChannelMessage:()=>Mr,ChannelMetadata:()=>Hr,ChannelMuteUser:()=>zr,ClassifiedListing:()=>qo,ClientAuth:()=>vo,CommunitiesList:()=>lo,CommunityDefinition:()=>Go,CommunityPostApproval:()=>Yr,Contacts:()=>Lr,CreateOrUpdateProduct:()=>Bo,CreateOrUpdateStall:()=>To,Curationsets:()=>Lo,Date:()=>Wo,DirectMessageRelaysList:()=>go,DraftClassifiedListing:()=>zo,DraftLong:()=>$o,Emojisets:()=>jo,EncryptedDirectMessage:()=>Ir,EventDeletion:()=>Ur,FileMetadata:()=>Kr,FileServerPreference:()=>wo,Followsets:()=>ko,GenericRepost:()=>jr,Genericlists:()=>So,GiftWrap:()=>Dr,HTTPAuth:()=>Ao,Handlerinformation:()=>Zo,Handlerrecommendation:()=>Vo,Highlights:()=>oo,InterestsList:()=>po,Interestsets:()=>No,JobFeedback:()=>to,JobRequest:()=>Qr,JobResult:()=>Xr,Label:()=>Jr,LightningPubRPC:()=>bo,LiveChatMessage:()=>Fr,LiveEvent:()=>Ho,LongFormArticle:()=>Po,Metadata:()=>Sr,Mutelist:()=>so,NWCWalletInfo:()=>mo,NWCWalletRequest:()=>Eo,NWCWalletResponse:()=>xo,NostrConnect:()=>Ro,OpenTimestamps:()=>Wr,Pinlist:()=>io,PrivateDirectMessage:()=>$r,ProblemTracker:()=>Vr,ProfileBadges:()=>Io,PublicChatsList:()=>uo,Reaction:()=>Tr,RecommendRelay:()=>Or,RelayList:()=>ao,Relaysets:()=>_o,Report:()=>Zr,Reporting:()=>Gr,Repost:()=>Nr,Seal:()=>Pr,SearchRelaysList:()=>ho,ShortTextNote:()=>_r,Time:()=>Do,UserEmojiList:()=>yo,UserStatuses:()=>Mo,Zap:()=>ro,ZapGoal:()=>eo,ZapRequest:()=>no,classifyKind:()=>Ar,isAddressableKind:()=>xr,isEphemeralKind:()=>Er,isKind:()=>kr,isParameterizedReplaceableKind:()=>Rr,isRegularKind:()=>br,isReplaceableKind:()=>vr});var Rr=xr;function Ar(t){return br(t)?"regular":vr(t)?"replaceable":Er(t)?"ephemeral":xr(t)?"parameterized":"unknown"}function kr(t,e){const n=e instanceof Array?e:[e];return or(t)&&n.includes(t.kind)||!1}var Sr=0,_r=1,Or=2,Lr=3,Ir=4,Ur=5,Nr=6,Tr=7,Br=8,Pr=13,$r=14,jr=16,Cr=40,Hr=41,Mr=42,qr=43,zr=44,Wr=1040,Dr=1059,Kr=1063,Fr=1311,Vr=1971,Zr=1984,Gr=1984,Jr=1985,Yr=4550,Qr=5999,Xr=6999,to=7e3,eo=9041,no=9734,ro=9735,oo=9802,so=1e4,io=10001,ao=10002,co=10003,lo=10004,uo=10005,fo=10006,ho=10007,po=10015,yo=10030,go=10050,wo=10096,mo=13194,bo=21e3,vo=22242,Eo=23194,xo=23195,Ro=24133,Ao=27235,ko=3e4,So=30001,_o=30002,Oo=30003,Lo=30004,Io=30008,Uo=30009,No=30015,To=30017,Bo=30018,Po=30023,$o=30024,jo=30030,Co=30078,Ho=30311,Mo=30315,qo=30402,zo=30403,Wo=31922,Do=31923,Ko=31924,Fo=31925,Vo=31989,Zo=31990,Go=34550;function Jo(t,e){if(t.ids&&-1===t.ids.indexOf(e.id))return!1;if(t.kinds&&-1===t.kinds.indexOf(e.kind))return!1;if(t.authors&&-1===t.authors.indexOf(e.pubkey))return!1;for(let n in t)if("#"===n[0]){let r=t[`#${n.slice(1)}`];if(r&&!e.tags.find((([t,e])=>t===n.slice(1)&&-1!==r.indexOf(e))))return!1}return!(t.since&&e.created_at<t.since||t.until&&e.created_at>t.until)}function Yo(t,e){let n=e.length+3,r=t.indexOf(`"${e}":`)+n,o=t.slice(r).indexOf('"')+r+1;return t.slice(o,o+64)}function Qo(t,e){let n=e.length,r=t.indexOf(`"${e}":`)+n+3,o=t.slice(r),s=Math.min(o.indexOf(","),o.indexOf("}"));return parseInt(o.slice(0,s),10)}function Xo(t){let e=t.slice(0,22).indexOf('"EVENT"');if(-1===e)return null;let n=t.slice(e+7+1).indexOf('"');if(-1===n)return null;let r=e+7+1+n,o=t.slice(r+1,80).indexOf('"');if(-1===o)return null;let s=r+1+o;return t.slice(r+1,s)}function ts(t,e){return e===Yo(t,"id")}function es(t,e){return e===Yo(t,"pubkey")}function ns(t,e){return e===Qo(t,"kind")}function rs(t,e){return{kind:vo,created_at:Math.floor(Date.now()/1e3),tags:[["relay",t],["challenge",e]],content:""}}async function os(){return new Promise((t=>{const e=new MessageChannel,n=()=>{e.port1.removeEventListener("message",n),t()};e.port1.addEventListener("message",n),e.port2.postMessage(0),e.port1.start()}))}nr({},{getHex64:()=>Yo,getInt:()=>Qo,getSubscriptionId:()=>Xo,matchEventId:()=>ts,matchEventKind:()=>ns,matchEventPubkey:()=>es}),nr({},{makeAuthEvent:()=>rs});var ss=t=>(t[rr]=!0,!0),is=class{url;_connected=!1;onclose=null;onnotice=t=>console.debug(`NOTICE from ${this.url}: ${t}`);_onauth=null;baseEoseTimeout=4400;connectionTimeout=4400;publishTimeout=4400;openSubs=new Map;connectionTimeoutHandle;connectionPromise;openCountRequests=new Map;openEventPublishes=new Map;ws;incomingMessageQueue=new hr;queueRunning=!1;challenge;serial=0;verifyEvent;_WebSocket;constructor(t,e){this.url=ar(t),this.verifyEvent=e.verifyEvent,this._WebSocket=e.websocketImplementation||WebSocket}static async connect(t,e){const n=new is(t,e);return await n.connect(),n}closeAllSubscriptions(t){for(let[e,n]of this.openSubs)n.close(t);this.openSubs.clear();for(let[e,n]of this.openEventPublishes)n.reject(new Error(t));this.openEventPublishes.clear();for(let[e,n]of this.openCountRequests)n.reject(new Error(t));this.openCountRequests.clear()}get connected(){return this._connected}async connect(){return this.connectionPromise||(this.challenge=void 0,this.connectionPromise=new Promise(((t,e)=>{this.connectionTimeoutHandle=setTimeout((()=>{e("connection timed out"),this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection timed out")}),this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(t){return void e(t)}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,t()},this.ws.onerror=t=>{e(t.message||"websocket error"),this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection errored"))},this.ws.onclose=async()=>{this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection closed"))},this.ws.onmessage=this._onmessage.bind(this)}))),this.connectionPromise}async runQueue(){for(this.queueRunning=!0;!1!==this.handleNext();)await os();this.queueRunning=!1}handleNext(){const t=this.incomingMessageQueue.dequeue();if(!t)return!1;const e=Xo(t);if(e){const n=this.openSubs.get(e);if(!n)return;const r=Yo(t,"id"),o=n.alreadyHaveEvent?.(r);if(n.receivedEvent?.(this,r),o)return}try{let e=JSON.parse(t);switch(e[0]){case"EVENT":{const t=this.openSubs.get(e[1]),n=e[2];return void(this.verifyEvent(n)&&function(t,e){for(let n=0;n<t.length;n++)if(Jo(t[n],e))return!0;return!1}(t.filters,n)&&t.onevent(n))}case"COUNT":{const t=e[1],n=e[2],r=this.openCountRequests.get(t);return void(r&&(r.resolve(n.count),this.openCountRequests.delete(t)))}case"EOSE":{const t=this.openSubs.get(e[1]);if(!t)return;return void t.receivedEose()}case"OK":{const t=e[1],n=e[2],r=e[3],o=this.openEventPublishes.get(t);return void(o&&(clearTimeout(o.timeout),n?o.resolve(r):o.reject(new Error(r)),this.openEventPublishes.delete(t)))}case"CLOSED":{const t=e[1],n=this.openSubs.get(t);if(!n)return;return n.closed=!0,void n.close(e[2])}case"NOTICE":return void this.onnotice(e[1]);case"AUTH":return this.challenge=e[1],void this._onauth?.(e[1])}}catch(t){return}}async send(t){if(!this.connectionPromise)throw new Error("sending on closed connection");this.connectionPromise.then((()=>{this.ws?.send(t)}))}async auth(t){if(!this.challenge)throw new Error("can't perform auth, no challenge was received");const e=await t(rs(this.url,this.challenge)),n=new Promise(((t,n)=>{const r=setTimeout((()=>{const t=this.openEventPublishes.get(e.id);t&&(t.reject(new Error("auth timed out")),this.openEventPublishes.delete(e.id))}),this.publishTimeout);this.openEventPublishes.set(e.id,{resolve:t,reject:n,timeout:r})}));return this.send('["AUTH",'+JSON.stringify(e)+"]"),n}async publish(t){const e=new Promise(((e,n)=>{const r=setTimeout((()=>{const e=this.openEventPublishes.get(t.id);e&&(e.reject(new Error("publish timed out")),this.openEventPublishes.delete(t.id))}),this.publishTimeout);this.openEventPublishes.set(t.id,{resolve:e,reject:n,timeout:r})}));return this.send('["EVENT",'+JSON.stringify(t)+"]"),e}async count(t,e){this.serial++;const n=e?.id||"count:"+this.serial,r=new Promise(((t,e)=>{this.openCountRequests.set(n,{resolve:t,reject:e})}));return this.send('["COUNT","'+n+'",'+JSON.stringify(t).substring(1)),r}subscribe(t,e){const n=this.prepareSubscription(t,e);return n.fire(),n}prepareSubscription(t,e){this.serial++;const n=e.id||(e.label?e.label+":":"sub:")+this.serial,r=new as(this,n,t,e);return this.openSubs.set(n,r),r}close(){this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,this.ws?.close()}_onmessage(t){this.incomingMessageQueue.enqueue(t.data),this.queueRunning||this.runQueue()}},as=class{relay;id;closed=!1;eosed=!1;filters;alreadyHaveEvent;receivedEvent;onevent;oneose;onclose;eoseTimeout;eoseTimeoutHandle;constructor(t,e,n,r){this.relay=t,this.filters=n,this.id=e,this.alreadyHaveEvent=r.alreadyHaveEvent,this.receivedEvent=r.receivedEvent,this.eoseTimeout=r.eoseTimeout||t.baseEoseTimeout,this.oneose=r.oneose,this.onclose=r.onclose,this.onevent=r.onevent||(t=>{console.warn(`onevent() callback not defined for subscription '${this.id}' in relay ${this.relay.url}. event received:`,t)})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,this.oneose?.())}close(t="closed by caller"){!this.closed&&this.relay.connected&&(this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]"),this.closed=!0),this.relay.openSubs.delete(this.id),this.onclose?.(t)}};try{WebSocket}catch{}var cs,ls=class{relays=new Map;seenOn=new Map;trackRelays=!1;verifyEvent;trustedRelayURLs=new Set;_WebSocket;constructor(t){this.verifyEvent=t.verifyEvent,this._WebSocket=t.websocketImplementation}async ensureRelay(t,e){t=ar(t);let n=this.relays.get(t);return n||(n=new is(t,{verifyEvent:this.trustedRelayURLs.has(t)?ss:this.verifyEvent,websocketImplementation:this._WebSocket}),e?.connectionTimeout&&(n.connectionTimeout=e.connectionTimeout),this.relays.set(t,n)),await n.connect(),n}close(t){t.map(ar).forEach((t=>{this.relays.get(t)?.close()}))}subscribeMany(t,e,n){return this.subscribeManyMap(Object.fromEntries(t.map((t=>[t,e]))),n)}subscribeManyMap(t,e){this.trackRelays&&(e.receivedEvent=(t,e)=>{let n=this.seenOn.get(e);n||(n=new Set,this.seenOn.set(e,n)),n.add(t)});const n=new Set,r=[],o=Object.keys(t).length,s=[];let i=t=>{s[t]||(s[t]=!0,s.filter((t=>t)).length===o&&(e.oneose?.(),i=()=>{}))};const a=[];let c=(t,n)=>{a[t]||(i(t),a[t]=n,a.filter((t=>t)).length===o&&(e.onclose?.(a),c=()=>{}))};const l=t=>{if(e.alreadyHaveEvent?.(t))return!0;const r=n.has(t);return n.add(t),r},u=Promise.all(Object.entries(t).map((async(t,n,o)=>{if(o.indexOf(t)!==n)return void c(n,"duplicate url");let s,[a,u]=t;a=ar(a);try{s=await this.ensureRelay(a,{connectionTimeout:e.maxWait?Math.max(.8*e.maxWait,e.maxWait-1e3):void 0})}catch(t){return void c(n,t?.message||String(t))}let f=s.subscribe(u,{...e,oneose:()=>i(n),onclose:t=>c(n,t),alreadyHaveEvent:l,eoseTimeout:e.maxWait});r.push(f)})));return{async close(){await u,r.forEach((t=>{t.close()}))}}}subscribeManyEose(t,e,n){const r=this.subscribeMany(t,e,{...n,oneose(){r.close()}});return r}async querySync(t,e,n){return new Promise((async r=>{const o=[];this.subscribeManyEose(t,[e],{...n,onevent(t){o.push(t)},onclose(t){r(o)}})}))}async get(t,e,n){e.limit=1;const r=await this.querySync(t,e,n);return r.sort(((t,e)=>e.created_at-t.created_at)),r[0]||null}publish(t,e){return t.map(ar).map((async(t,n,r)=>{if(r.indexOf(t)!==n)return Promise.reject("duplicate url");let o=await this.ensureRelay(t);return o.publish(e).then((t=>{if(this.trackRelays){let t=this.seenOn.get(e.id);t||(t=new Set,this.seenOn.set(e.id,t)),t.add(o)}return t}))}))}listConnectionStatus(){const t=new Map;return this.relays.forEach(((e,n)=>t.set(n,e.connected))),t}destroy(){this.relays.forEach((t=>t.close())),this.relays=new Map}};try{cs=WebSocket}catch{}var us={};nr(us,{BECH32_REGEX:()=>ds,Bech32MaxSize:()=>hs,NostrTypeGuard:()=>fs,decode:()=>ys,decodeNostrURI:()=>ps,encodeBytes:()=>Es,naddrEncode:()=>As,neventEncode:()=>Rs,noteEncode:()=>bs,nprofileEncode:()=>xs,npubEncode:()=>ms,nsecEncode:()=>ws});var fs={isNProfile:t=>/^nprofile1[a-z\d]+$/.test(t||""),isNEvent:t=>/^nevent1[a-z\d]+$/.test(t||""),isNAddr:t=>/^naddr1[a-z\d]+$/.test(t||""),isNSec:t=>/^nsec1[a-z\d]{58}$/.test(t||""),isNPub:t=>/^npub1[a-z\d]{58}$/.test(t||""),isNote:t=>/^note1[a-z\d]+$/.test(t||""),isNcryptsec:t=>/^ncryptsec1[a-z\d]+$/.test(t||"")},hs=5e3,ds=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function ps(t){try{return t.startsWith("nostr:")&&(t=t.substring(6)),ys(t)}catch(t){return{type:"invalid",data:null}}}function ys(t){let{prefix:e,words:n}=Be.decode(t,hs),r=new Uint8Array(Be.fromWords(n));switch(e){case"nprofile":{let t=gs(r);if(!t[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(32!==t[0][0].length)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:Yt(t[0][0]),relays:t[1]?t[1].map((t=>sr.decode(t))):[]}}}case"nevent":{let t=gs(r);if(!t[0]?.[0])throw new Error("missing TLV 0 for nevent");if(32!==t[0][0].length)throw new Error("TLV 0 should be 32 bytes");if(t[2]&&32!==t[2][0].length)throw new Error("TLV 2 should be 32 bytes");if(t[3]&&4!==t[3][0].length)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:Yt(t[0][0]),relays:t[1]?t[1].map((t=>sr.decode(t))):[],author:t[2]?.[0]?Yt(t[2][0]):void 0,kind:t[3]?.[0]?parseInt(Yt(t[3][0]),16):void 0}}}case"naddr":{let t=gs(r);if(!t[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!t[2]?.[0])throw new Error("missing TLV 2 for naddr");if(32!==t[2][0].length)throw new Error("TLV 2 should be 32 bytes");if(!t[3]?.[0])throw new Error("missing TLV 3 for naddr");if(4!==t[3][0].length)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:sr.decode(t[0][0]),pubkey:Yt(t[2][0]),kind:parseInt(Yt(t[3][0]),16),relays:t[1]?t[1].map((t=>sr.decode(t))):[]}}}case"nsec":return{type:e,data:r};case"npub":case"note":return{type:e,data:Yt(r)};default:throw new Error(`unknown prefix ${e}`)}}function gs(t){let e={},n=t;for(;n.length>0;){let t=n[0],r=n[1],o=n.slice(2,2+r);if(n=n.slice(2+r),o.length<r)throw new Error(`not enough data to read on TLV ${t}`);e[t]=e[t]||[],e[t].push(o)}return e}function ws(t){return Es("nsec",t)}function ms(t){return Es("npub",Qt(t))}function bs(t){return Es("note",Qt(t))}function vs(t,e){let n=Be.toWords(e);return Be.encode(t,n,hs)}function Es(t,e){return vs(t,e)}function xs(t){return vs("nprofile",ks({0:[Qt(t.pubkey)],1:(t.relays||[]).map((t=>ir.encode(t)))}))}function Rs(t){let e;return void 0!==t.kind&&(e=function(t){const e=new Uint8Array(4);return e[0]=t>>24&255,e[1]=t>>16&255,e[2]=t>>8&255,e[3]=255&t,e}(t.kind)),vs("nevent",ks({0:[Qt(t.id)],1:(t.relays||[]).map((t=>ir.encode(t))),2:t.author?[Qt(t.author)]:[],3:e?[new Uint8Array(e)]:[]}))}function As(t){let e=new ArrayBuffer(4);return new DataView(e).setUint32(0,t.kind,!1),vs("naddr",ks({0:[ir.encode(t.identifier)],1:(t.relays||[]).map((t=>ir.encode(t))),2:[Qt(t.pubkey)],3:[new Uint8Array(e)]}))}function ks(t){let e=[];return Object.entries(t).reverse().forEach((([t,n])=>{n.forEach((n=>{let r=new Uint8Array(n.length+2);r.set([parseInt(t)],0),r.set([n.length],1),r.set(n,2),e.push(r)}))})),te(...e)}async function Ss(t,e,n){const r=t instanceof Uint8Array?Yt(t):t,o=Os(Lt.getSharedSecret(r,"02"+e));let s=Uint8Array.from(re(16)),i=ir.encode(n),a=_n(o,s).encrypt(i);return`${_e.encode(new Uint8Array(a))}?iv=${_e.encode(new Uint8Array(s.buffer))}`}async function _s(t,e,n){const r=t instanceof Uint8Array?Yt(t):t;let[o,s]=n.split("?iv="),i=Os(Lt.getSharedSecret(r,"02"+e)),a=_e.decode(s),c=_e.decode(o),l=_n(i,a).decrypt(c);return sr.decode(l)}function Os(t){return t.slice(1,33)}nr({},{decrypt:()=>_s,encrypt:()=>Ss}),nr({},{NIP05_REGEX:()=>Is,isNip05:()=>Us,isValid:()=>Ps,queryProfile:()=>Bs,searchDomain:()=>Ts,useFetchImplementation:()=>Ns});var Ls,Is=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,Us=t=>Is.test(t||"");try{Ls=fetch}catch(t){}function Ns(t){Ls=t}async function Ts(t,e=""){try{const n=`https://${t}/.well-known/nostr.json?name=${e}`,r=await Ls(n,{redirect:"manual"});if(200!==r.status)throw Error("Wrong response code");return(await r.json()).names}catch(t){return{}}}async function Bs(t){const e=t.match(Is);if(!e)return null;const[,n="_",r]=e;try{const t=`https://${r}/.well-known/nostr.json?name=${n}`,e=await Ls(t,{redirect:"manual"});if(200!==e.status)throw Error("Wrong response code");const o=await e.json(),s=o.names[n];return s?{pubkey:s,relays:o.relays?.[s]}:null}catch(t){return null}}async function Ps(t,e){const n=await Bs(e);return!!n&&n.pubkey===t}function $s(t){const e={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let n,r;for(let o=t.tags.length-1;o>=0;o--){const s=t.tags[o];if("e"===s[0]&&s[1]){const[t,o,i,a,c]=s,l={id:o,relays:i?[i]:[],author:c};if("root"===a){e.root=l;continue}if("reply"===a){e.reply=l;continue}if("mention"===a){e.mentions.push(l);continue}n?r=l:n=l,e.mentions.push(l)}else{if("q"===s[0]&&s[1]){const[t,n,r]=s;e.quotes.push({id:n,relays:r?[r]:[]})}"p"===s[0]&&s[1]&&e.profiles.push({pubkey:s[1],relays:s[2]?[s[2]]:[]})}}return e.root||(e.root=r||n||e.reply),e.reply||(e.reply=n||e.root),[e.reply,e.root].forEach((t=>{if(!t)return;let n=e.mentions.indexOf(t);if(-1!==n&&e.mentions.splice(n,1),t.author){let n=e.profiles.find((e=>e.pubkey===t.author));n&&n.relays&&(t.relays||(t.relays=[]),n.relays.forEach((e=>{-1===t.relays?.indexOf(e)&&t.relays.push(e)})),n.relays=t.relays)}})),e.mentions.forEach((t=>{if(t.author){let n=e.profiles.find((e=>e.pubkey===t.author));n&&n.relays&&(t.relays||(t.relays=[]),n.relays.forEach((e=>{-1===t.relays.indexOf(e)&&t.relays.push(e)})),n.relays=t.relays)}})),e}nr({},{parse:()=>$s}),nr({},{fetchRelayInformation:()=>Cs,useFetchImplementation:()=>js});try{fetch}catch{}function js(t){}async function Cs(t){return await(await fetch(t.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}function Hs(t){let e=0;for(let n=0;n<64;n+=8){const r=parseInt(t.substring(n,n+8),16);if(0!==r){e+=Math.clz32(r);break}e+=32}return e}function Ms(t,e){let n=0;const r=t,o=["nonce",n.toString(),e.toString()];for(r.tags.push(o);;){const t=Math.floor((new Date).getTime()/1e3);if(t!==r.created_at&&(n=0,r.created_at=t),o[1]=(++n).toString(),r.id=qs(r),Hs(r.id)>=e)break}return r}function qs(t){return Yt(pe(ir.encode(JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content]))))}nr({},{fastEventHash:()=>qs,getPow:()=>Hs,minePow:()=>Ms}),nr({},{unwrapEvent:()=>fi,unwrapManyEvents:()=>hi,wrapEvent:()=>li,wrapManyEvents:()=>ui}),nr({},{createRumor:()=>ni,createSeal:()=>ri,createWrap:()=>oi,unwrapEvent:()=>ai,unwrapManyEvents:()=>ci,wrapEvent:()=>si,wrapManyEvents:()=>ii}),nr({},{decrypt:()=>Gs,encrypt:()=>Zs,getConversationKey:()=>Ds,v2:()=>Js});var zs=1,Ws=65535;function Ds(t,e){const n=Lt.getSharedSecret(t,"02"+e).subarray(1,33);return r=pe,o=n,s="nip44-v2",ie.hash(r),void 0===s&&(s=new Uint8Array(r.outputLen)),Qn(r,Xt(s),Xt(o));var r,o,s}function Ks(t,e){const n=function(t,e,n,r=32){if(ie.hash(t),ie.number(r),r>255*t.outputLen)throw new Error("Length should be <= 255*HashLen");const o=Math.ceil(r/t.outputLen);void 0===n&&(n=tr);const s=new Uint8Array(o*t.outputLen),i=Qn.create(t,e),a=i._cloneInto(),c=new Uint8Array(i.outputLen);for(let e=0;e<o;e++)Xn[0]=e+1,a.update(0===e?tr:c).update(n).update(Xn).digestInto(c),s.set(c,t.outputLen*e),i._cloneInto(a);return i.destroy(),a.destroy(),c.fill(0),Xn.fill(0),s.slice(0,r)}(pe,t,e,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function Fs(t){if(!Number.isSafeInteger(t)||t<1)throw new Error("expected positive integer");if(t<=32)return 32;const e=1<<Math.floor(Math.log2(t-1))+1,n=e<=256?32:e/8;return n*(Math.floor((t-1)/n)+1)}function Vs(t,e,n){if(32!==n.length)throw new Error("AAD associated data must be 32 bytes");const r=te(n,e);return Qn(pe,t,r)}function Zs(t,e,n=re(32)){const{chacha_key:r,chacha_nonce:o,hmac_key:s}=Ks(e,n),i=function(t){const e=ir.encode(t),n=e.length;return te(function(t){if(!Number.isSafeInteger(t)||t<zs||t>Ws)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const e=new Uint8Array(2);return new DataView(e.buffer).setUint16(0,t,!1),e}(n),e,new Uint8Array(Fs(n)-n))}(t),a=Dn(r,o,i),c=Vs(s,a,n);return _e.encode(te(new Uint8Array([2]),n,a,c))}function Gs(t,e){const{nonce:n,ciphertext:r,mac:o}=function(t){if("string"!=typeof t)throw new Error("payload must be a valid string");const e=t.length;if(e<132||e>87472)throw new Error("invalid payload length: "+e);if("#"===t[0])throw new Error("unknown encryption version");let n;try{n=_e.decode(t)}catch(t){throw new Error("invalid base64: "+t.message)}const r=n.length;if(r<99||r>65603)throw new Error("invalid data length: "+r);const o=n[0];if(2!==o)throw new Error("unknown encryption version "+o);return{nonce:n.subarray(1,33),ciphertext:n.subarray(33,-32),mac:n.subarray(-32)}}(t),{chacha_key:s,chacha_nonce:i,hmac_key:a}=Ks(e,n);if(!Ke(Vs(a,r,n),o))throw new Error("invalid MAC");return function(t){const e=new DataView(t.buffer).getUint16(0),n=t.subarray(2,2+e);if(e<zs||e>Ws||n.length!==e||t.length!==2+Fs(e))throw new Error("invalid padding");return sr.decode(n)}(Dn(s,i,r))}var Js={utils:{getConversationKey:Ds,calcPaddedLen:Fs},encrypt:Zs,decrypt:Gs},Ys=()=>Math.round(Date.now()/1e3),Qs=()=>Math.round(Ys()-172800*Math.random()),Xs=(t,e)=>Ds(t,e),ti=(t,e,n)=>Zs(JSON.stringify(t),Xs(e,n)),ei=(t,e)=>JSON.parse(Gs(t.content,Xs(e,t.pubkey)));function ni(t,e){const n={created_at:Ys(),content:"",tags:[],...t,pubkey:gr(e)};return n.id=dr(n),n}function ri(t,e,n){return wr({kind:Pr,content:ti(t,e,n),created_at:Qs(),tags:[]},e)}function oi(t,e){const n=yr();return wr({kind:Dr,content:ti(t,n,e),created_at:Qs(),tags:[["p",e]]},n)}function si(t,e,n){return oi(ri(ni(t,e),e,n),n)}function ii(t,e,n){if(!n||0===n.length)throw new Error("At least one recipient is required.");const r=gr(e),o=[si(t,e,r)];return n.forEach((n=>{o.push(si(t,e,n))})),o}function ai(t,e){const n=ei(t,e);return ei(n,e)}function ci(t,e){let n=[];return t.forEach((t=>{n.push(ai(t,e))})),n.sort(((t,e)=>t.created_at-e.created_at)),n}function li(t,e,n,r,o){const s=function(t,e,n,r){const o={created_at:Math.ceil(Date.now()/1e3),kind:$r,tags:[],content:e};return(Array.isArray(t)?t:[t]).forEach((({publicKey:t,relayUrl:e})=>{o.tags.push(e?["p",t,e]:["p",t])})),r&&o.tags.push(["e",r.eventId,r.relayUrl||"","reply"]),n&&o.tags.push(["subject",n]),o}(e,n,r,o);return si(s,t,e.publicKey)}function ui(t,e,n,r,o){if(!e||0===e.length)throw new Error("At least one recipient is required.");return[{publicKey:gr(t)},...e].map((e=>li(t,e,n,r,o)))}var fi=ai,hi=ci;function di(t,e,n,r){let o;const s=[...t.tags??[],["e",e.id,n],["p",e.pubkey]];return e.kind===_r?o=Nr:(o=jr,s.push(["k",String(e.kind)])),wr({kind:o,tags:s,content:""===t.content||e.tags?.find((t=>"-"===t[0]))?"":JSON.stringify(e),created_at:t.created_at},r)}function pi(t){if(![Nr,jr].includes(t.kind))return;let e,n;for(let r=t.tags.length-1;r>=0&&(void 0===e||void 0===n);r--){const o=t.tags[r];o.length>=2&&("e"===o[0]&&void 0===e?e=o:"p"===o[0]&&void 0===n&&(n=o))}return void 0!==e?{id:e[1],relays:[e[2],n?.[2]].filter((t=>"string"==typeof t)),author:n?.[1]}:void 0}function yi(t,{skipVerification:e}={}){const n=pi(t);if(void 0===n||""===t.content)return;let r;try{r=JSON.parse(t.content)}catch(t){return}return r.id===n.id&&(e||mr(r))?r:void 0}nr({},{finishRepostEvent:()=>di,getRepostedEvent:()=>yi,getRepostedEventPointer:()=>pi}),nr({},{NOSTR_URI_REGEX:()=>gi,parse:()=>mi,test:()=>wi});var gi=new RegExp(`nostr:(${ds.source})`);function wi(t){return"string"==typeof t&&new RegExp(`^${gi.source}$`).test(t)}function mi(t){const e=t.match(new RegExp(`^${gi.source}$`));if(!e)throw new Error(`Invalid Nostr URI: ${t}`);return{uri:e[0],value:e[1],decoded:ys(e[1])}}function bi(t,e,n){const r=e.tags.filter((t=>t.length>=2&&("e"===t[0]||"p"===t[0])));return wr({...t,kind:Tr,tags:[...t.tags??[],...r,["e",e.id],["p",e.pubkey]],content:t.content??"+"},n)}function vi(t){if(t.kind!==Tr)return;let e,n;for(let r=t.tags.length-1;r>=0&&(void 0===e||void 0===n);r--){const o=t.tags[r];o.length>=2&&("e"===o[0]&&void 0===e?e=o:"p"===o[0]&&void 0===n&&(n=o))}return void 0!==e&&void 0!==n?{id:e[1],relays:[e[2],n[2]].filter((t=>void 0!==t)),author:n[1]}:void 0}nr({},{finishReactionEvent:()=>bi,getReactedEventPointer:()=>vi}),nr({},{parse:()=>Ri});var Ei=/\W/m,xi=/\W |\W$|$|,| /m;function*Ri(t){const e=t.length;let n=0,r=0;for(;r<e;){let o=t.indexOf(":",r);if(-1===o)break;if("nostr"===t.substring(o-5,o)){const s=t.substring(o+60).match(Ei),i=s?o+60+s.index:e;try{let e,{data:s,type:a}=ys(t.substring(o+1,i));switch(a){case"npub":e={pubkey:s};break;case"nsec":case"note":r=i+1;continue;default:e=s}n!==o-5&&(yield{type:"text",text:t.substring(n,o-5)}),yield{type:"reference",pointer:e},r=i,n=r;continue}catch(t){r=o+1;continue}}else if("https"===t.substring(o-5,o)||"http"===t.substring(o-4,o)){const s=t.substring(o+4).match(xi),i=s?o+4+s.index:e,a="s"===t[o-1]?5:4;try{let e=new URL(t.substring(o-a,i));if(-1===e.hostname.indexOf("."))throw new Error("invalid url");if(n!==o-a&&(yield{type:"text",text:t.substring(n,o-a)}),e.pathname.endsWith(".png")||e.pathname.endsWith(".jpg")||e.pathname.endsWith(".jpeg")||e.pathname.endsWith(".gif")||e.pathname.endsWith(".webp")){yield{type:"image",url:e.toString()},r=i,n=r;continue}if(e.pathname.endsWith(".mp4")||e.pathname.endsWith(".avi")||e.pathname.endsWith(".webm")||e.pathname.endsWith(".mkv")){yield{type:"video",url:e.toString()},r=i,n=r;continue}if(e.pathname.endsWith(".mp3")||e.pathname.endsWith(".aac")||e.pathname.endsWith(".ogg")||e.pathname.endsWith(".opus")){yield{type:"audio",url:e.toString()},r=i,n=r;continue}yield{type:"url",url:e.toString()},r=i,n=r;continue}catch(t){r=i+1;continue}}else{if("wss"!==t.substring(o-3,o)&&"ws"!==t.substring(o-2,o)){r=o+1;continue}{const s=t.substring(o+4).match(xi),i=s?o+4+s.index:e,a="s"===t[o-1]?3:2;try{let e=new URL(t.substring(o-a,i));if(-1===e.hostname.indexOf("."))throw new Error("invalid ws url");n!==o-a&&(yield{type:"text",text:t.substring(n,o-a)}),yield{type:"relay",url:e.toString()},r=i,n=r;continue}catch(t){r=i+1;continue}}}}n!==e&&(yield{type:"text",text:t.substring(n)})}nr({},{channelCreateEvent:()=>Ai,channelHideMessageEvent:()=>_i,channelMessageEvent:()=>Si,channelMetadataEvent:()=>ki,channelMuteUserEvent:()=>Oi});var Ai=(t,e)=>{let n;if("object"==typeof t.content)n=JSON.stringify(t.content);else{if("string"!=typeof t.content)return;n=t.content}return wr({kind:Cr,tags:[...t.tags??[]],content:n,created_at:t.created_at},e)},ki=(t,e)=>{let n;if("object"==typeof t.content)n=JSON.stringify(t.content);else{if("string"!=typeof t.content)return;n=t.content}return wr({kind:Hr,tags:[["e",t.channel_create_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},Si=(t,e)=>{const n=[["e",t.channel_create_event_id,t.relay_url,"root"]];return t.reply_to_channel_message_event_id&&n.push(["e",t.reply_to_channel_message_event_id,t.relay_url,"reply"]),wr({kind:Mr,tags:[...n,...t.tags??[]],content:t.content,created_at:t.created_at},e)},_i=(t,e)=>{let n;if("object"==typeof t.content)n=JSON.stringify(t.content);else{if("string"!=typeof t.content)return;n=t.content}return wr({kind:qr,tags:[["e",t.channel_message_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},Oi=(t,e)=>{let n;if("object"==typeof t.content)n=JSON.stringify(t.content);else{if("string"!=typeof t.content)return;n=t.content}return wr({kind:zr,tags:[["p",t.pubkey_to_mute],...t.tags??[]],content:n,created_at:t.created_at},e)};nr({},{EMOJI_SHORTCODE_REGEX:()=>Ui,matchAll:()=>Ti,regex:()=>Ni,replaceAll:()=>Bi});var Li,Ii,Ui=/:(\w+):/,Ni=()=>new RegExp(`\\B${Ui.source}\\B`,"g");function*Ti(t){const e=t.matchAll(Ni());for(const t of e)try{const[e,n]=t;yield{shortcode:e,name:n,start:t.index,end:t.index+e.length}}catch(t){}}function Bi(t,e){return t.replaceAll(Ni(),((t,n)=>e({shortcode:t,name:n})))}nr({},{useFetchImplementation:()=>Pi,validateGithub:()=>$i});try{Li=fetch}catch{}function Pi(t){Li=t}async function $i(t,e,n){try{return await(await Li(`https://gist.github.com/${e}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${t}`}catch(t){return!1}}function ji(t){const{pathname:e,searchParams:n}=new URL(t),r=e,o=n.get("relay"),s=n.get("secret");if(!r||!o||!s)throw new Error("invalid connection string");return{pubkey:r,relay:o,secret:s}}async function Ci(t,e,n){const r={method:"pay_invoice",params:{invoice:n}},o=await Ss(e,t,JSON.stringify(r)),s={kind:Eo,created_at:Math.round(Date.now()/1e3),content:o,tags:[["p",t]]};return wr(s,e)}function Hi(t){return t=(t=t.trim().toLowerCase()).normalize("NFKC"),Array.from(t).map((t=>/\p{Letter}/u.test(t)||/\p{Number}/u.test(t)?t:"-")).join("")}nr({},{makeNwcRequestEvent:()=>Ci,parseConnectionString:()=>ji}),nr({},{normalizeIdentifier:()=>Hi}),nr({},{getZapEndpoint:()=>qi,makeZapReceipt:()=>Di,makeZapRequest:()=>zi,useFetchImplementation:()=>Mi,validateZapRequest:()=>Wi});try{Ii=fetch}catch{}function Mi(t){Ii=t}async function qi(t){try{let e="",{lud06:n,lud16:r}=JSON.parse(t.content);if(n){let{words:t}=Be.decode(n,1e3),r=Be.fromWords(t);e=sr.decode(r)}else{if(!r)return null;{let[t,n]=r.split("@");e=new URL(`/.well-known/lnurlp/${t}`,`https://${n}`).toString()}}let o=await Ii(e),s=await o.json();if(s.allowsNostr&&s.nostrPubkey)return s.callback}catch(t){}return null}function zi({profile:t,event:e,amount:n,relays:r,comment:o=""}){if(!n)throw new Error("amount not given");if(!t)throw new Error("profile not given");let s={kind:9734,created_at:Math.round(Date.now()/1e3),content:o,tags:[["p",t],["amount",n.toString()],["relays",...r]]};if(e&&"string"==typeof e&&s.tags.push(["e",e]),e&&"object"==typeof e)if(vr(e.kind)){const t=["a",`${e.kind}:${e.pubkey}:`];s.tags.push(t)}else if(xr(e.kind)){let t=e.tags.find((([t,e])=>"d"===t&&e));if(!t)throw new Error("d tag not found or is empty");const n=["a",`${e.kind}:${e.pubkey}:${t[1]}`];s.tags.push(n)}return s}function Wi(t){let e;try{e=JSON.parse(t)}catch(t){return"Invalid zap request JSON."}if(!or(e))return"Zap request is not a valid Nostr event.";if(!mr(e))return"Invalid signature on zap request.";let n=e.tags.find((([t,e])=>"p"===t&&e));if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=e.tags.find((([t,e])=>"e"===t&&e));return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":e.tags.find((([t,e])=>"relays"===t&&e))?null:"Zap request doesn't have a 'relays' tag."}function Di({zapRequest:t,preimage:e,bolt11:n,paidAt:r}){let o=JSON.parse(t),s=o.tags.filter((([t])=>"e"===t||"p"===t||"a"===t)),i={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...s,["P",o.pubkey],["bolt11",n],["description",t]]};return e&&i.tags.push(["preimage",e]),i}nr({},{getToken:()=>Fi,hashPayload:()=>Xi,unpackEventFromToken:()=>Zi,validateEvent:()=>ea,validateEventKind:()=>Ji,validateEventMethodTag:()=>Qi,validateEventPayloadTag:()=>ta,validateEventTimestamp:()=>Gi,validateEventUrlTag:()=>Yi,validateToken:()=>Vi});var Ki="Nostr ";async function Fi(t,e,n,r=!1,o){const s={kind:Ao,tags:[["u",t],["method",e]],created_at:Math.round((new Date).getTime()/1e3),content:""};o&&s.tags.push(["payload",Xi(o)]);const i=await n(s);return(r?Ki:"")+_e.encode(ir.encode(JSON.stringify(i)))}async function Vi(t,e,n){const r=await Zi(t).catch((t=>{throw t}));return await ea(r,e,n).catch((t=>{throw t}))}async function Zi(t){if(!t)throw new Error("Missing token");t=t.replace(Ki,"");const e=sr.decode(_e.decode(t));if(!e||0===e.length||!e.startsWith("{"))throw new Error("Invalid token");return JSON.parse(e)}function Gi(t){return!!t.created_at&&Math.round((new Date).getTime()/1e3)-t.created_at<60}function Ji(t){return t.kind===Ao}function Yi(t,e){const n=t.tags.find((t=>"u"===t[0]));return!!n&&n.length>0&&n[1]===e}function Qi(t,e){const n=t.tags.find((t=>"method"===t[0]));return!!n&&n.length>0&&n[1].toLowerCase()===e.toLowerCase()}function Xi(t){return Yt(pe(ir.encode(JSON.stringify(t))))}function ta(t,e){const n=t.tags.find((t=>"payload"===t[0]));if(!n)return!1;const r=Xi(e);return n.length>0&&n[1]===r}async function ea(t,e,n,r){if(!mr(t))throw new Error("Invalid nostr event, signature invalid");if(!Ji(t))throw new Error("Invalid nostr event, kind invalid");if(!Gi(t))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!Yi(t,e))throw new Error("Invalid nostr event, url tag invalid");if(!Qi(t,n))throw new Error("Invalid nostr event, method tag invalid");if(Boolean(r)&&"object"==typeof r&&Object.keys(r).length>0&&!ta(t,r))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}var na=Symbol("verified");new TextDecoder("utf-8");var ra=new TextEncoder,oa=class{value;next=null;prev=null;constructor(t){this.value=t}},sa=class{first;last;constructor(){this.first=null,this.last=null}enqueue(t){const e=new oa(t);return this.last?this.last===this.first?(this.last=e,this.last.prev=this.first,this.first.next=e):(e.prev=this.last,this.last.next=e,this.last=e):(this.first=e,this.last=e),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const t=this.first;return this.first=null,this.last=null,t.value}const t=this.first;return this.first=t.next,t.value}};function ia(t){return Yt(pe(ra.encode(function(t){if(!function(t){if(!(t instanceof Object))return!1;if("number"!=typeof t.kind)return!1;if("string"!=typeof t.content)return!1;if("number"!=typeof t.created_at)return!1;if("string"!=typeof t.pubkey)return!1;if(!t.pubkey.match(/^[a-f0-9]{64}$/))return!1;if(!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){let n=t.tags[e];if(!Array.isArray(n))return!1;for(let t=0;t<n.length;t++)if("object"==typeof n[t])return!1}return!0}(t))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content])}(t))))}var aa=new class{generateSecretKey(){return Kt.utils.randomPrivateKey()}getPublicKey(t){return Yt(Kt.getPublicKey(t))}finalizeEvent(t,e){const n=t;return n.pubkey=Yt(Kt.getPublicKey(e)),n.id=ia(n),n.sig=Yt(Kt.sign(ia(n),e)),n[na]=!0,n}verifyEvent(t){if("boolean"==typeof t[na])return t[na];const e=ia(t);if(e!==t.id)return t[na]=!1,!1;try{const n=Kt.verify(t.sig,e,t.pubkey);return t[na]=n,n}catch(e){return t[na]=!1,!1}}},ca=(aa.generateSecretKey,aa.getPublicKey,aa.finalizeEvent,aa.verifyEvent);function la(t,e){if(t.ids&&-1===t.ids.indexOf(e.id))return!1;if(t.kinds&&-1===t.kinds.indexOf(e.kind))return!1;if(t.authors&&-1===t.authors.indexOf(e.pubkey))return!1;for(let n in t)if("#"===n[0]){let r=t[`#${n.slice(1)}`];if(r&&!e.tags.find((([t,e])=>t===n.slice(1)&&-1!==r.indexOf(e))))return!1}return!(t.since&&e.created_at<t.since||t.until&&e.created_at>t.until)}async function ua(){return new Promise((t=>{const e=new MessageChannel,n=()=>{e.port1.removeEventListener("message",n),t()};e.port1.addEventListener("message",n),e.port2.postMessage(0),e.port1.start()}))}var fa,ha=class{url;_connected=!1;onclose=null;onnotice=t=>console.debug(`NOTICE from ${this.url}: ${t}`);_onauth=null;baseEoseTimeout=4400;connectionTimeout=4400;publishTimeout=4400;openSubs=new Map;connectionTimeoutHandle;connectionPromise;openCountRequests=new Map;openEventPublishes=new Map;ws;incomingMessageQueue=new sa;queueRunning=!1;challenge;serial=0;verifyEvent;_WebSocket;constructor(t,e){this.url=function(t){-1===t.indexOf("://")&&(t="wss://"+t);let e=new URL(t);return e.pathname=e.pathname.replace(/\/+/g,"/"),e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),("80"===e.port&&"ws:"===e.protocol||"443"===e.port&&"wss:"===e.protocol)&&(e.port=""),e.searchParams.sort(),e.hash="",e.toString()}(t),this.verifyEvent=e.verifyEvent,this._WebSocket=e.websocketImplementation||WebSocket}static async connect(t,e){const n=new ha(t,e);return await n.connect(),n}closeAllSubscriptions(t){for(let[e,n]of this.openSubs)n.close(t);this.openSubs.clear();for(let[e,n]of this.openEventPublishes)n.reject(new Error(t));this.openEventPublishes.clear();for(let[e,n]of this.openCountRequests)n.reject(new Error(t));this.openCountRequests.clear()}get connected(){return this._connected}async connect(){return this.connectionPromise||(this.challenge=void 0,this.connectionPromise=new Promise(((t,e)=>{this.connectionTimeoutHandle=setTimeout((()=>{e("connection timed out"),this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection timed out")}),this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(t){return void e(t)}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,t()},this.ws.onerror=t=>{e(t.message||"websocket error"),this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection errored"))},this.ws.onclose=async()=>{this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection closed"))},this.ws.onmessage=this._onmessage.bind(this)}))),this.connectionPromise}async runQueue(){for(this.queueRunning=!0;!1!==this.handleNext();)await ua();this.queueRunning=!1}handleNext(){const t=this.incomingMessageQueue.dequeue();if(!t)return!1;const e=function(t){let e=t.slice(0,22).indexOf('"EVENT"');if(-1===e)return null;let n=t.slice(e+7+1).indexOf('"');if(-1===n)return null;let r=e+7+1+n,o=t.slice(r+1,80).indexOf('"');if(-1===o)return null;let s=r+1+o;return t.slice(r+1,s)}(t);if(e){const n=this.openSubs.get(e);if(!n)return;const r=function(t){let e=t.indexOf('"id":')+5,n=t.slice(e).indexOf('"')+e+1;return t.slice(n,n+64)}(t),o=n.alreadyHaveEvent?.(r);if(n.receivedEvent?.(this,r),o)return}try{let e=JSON.parse(t);switch(e[0]){case"EVENT":{const t=this.openSubs.get(e[1]),n=e[2];return void(this.verifyEvent(n)&&function(t,e){for(let n=0;n<t.length;n++)if(la(t[n],e))return!0;return!1}(t.filters,n)&&t.onevent(n))}case"COUNT":{const t=e[1],n=e[2],r=this.openCountRequests.get(t);return void(r&&(r.resolve(n.count),this.openCountRequests.delete(t)))}case"EOSE":{const t=this.openSubs.get(e[1]);if(!t)return;return void t.receivedEose()}case"OK":{const t=e[1],n=e[2],r=e[3],o=this.openEventPublishes.get(t);return void(o&&(clearTimeout(o.timeout),n?o.resolve(r):o.reject(new Error(r)),this.openEventPublishes.delete(t)))}case"CLOSED":{const t=e[1],n=this.openSubs.get(t);if(!n)return;return n.closed=!0,void n.close(e[2])}case"NOTICE":return void this.onnotice(e[1]);case"AUTH":return this.challenge=e[1],void this._onauth?.(e[1])}}catch(t){return}}async send(t){if(!this.connectionPromise)throw new Error("sending on closed connection");this.connectionPromise.then((()=>{this.ws?.send(t)}))}async auth(t){if(!this.challenge)throw new Error("can't perform auth, no challenge was received");const e=await t(function(t,e){return{kind:22242,created_at:Math.floor(Date.now()/1e3),tags:[["relay",t],["challenge",e]],content:""}}(this.url,this.challenge)),n=new Promise(((t,n)=>{const r=setTimeout((()=>{const t=this.openEventPublishes.get(e.id);t&&(t.reject(new Error("auth timed out")),this.openEventPublishes.delete(e.id))}),this.publishTimeout);this.openEventPublishes.set(e.id,{resolve:t,reject:n,timeout:r})}));return this.send('["AUTH",'+JSON.stringify(e)+"]"),n}async publish(t){const e=new Promise(((e,n)=>{const r=setTimeout((()=>{const e=this.openEventPublishes.get(t.id);e&&(e.reject(new Error("publish timed out")),this.openEventPublishes.delete(t.id))}),this.publishTimeout);this.openEventPublishes.set(t.id,{resolve:e,reject:n,timeout:r})}));return this.send('["EVENT",'+JSON.stringify(t)+"]"),e}async count(t,e){this.serial++;const n=e?.id||"count:"+this.serial,r=new Promise(((t,e)=>{this.openCountRequests.set(n,{resolve:t,reject:e})}));return this.send('["COUNT","'+n+'",'+JSON.stringify(t).substring(1)),r}subscribe(t,e){const n=this.prepareSubscription(t,e);return n.fire(),n}prepareSubscription(t,e){this.serial++;const n=e.id||(e.label?e.label+":":"sub:")+this.serial,r=new da(this,n,t,e);return this.openSubs.set(n,r),r}close(){this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,this.ws?.close()}_onmessage(t){this.incomingMessageQueue.enqueue(t.data),this.queueRunning||this.runQueue()}},da=class{relay;id;closed=!1;eosed=!1;filters;alreadyHaveEvent;receivedEvent;onevent;oneose;onclose;eoseTimeout;eoseTimeoutHandle;constructor(t,e,n,r){this.relay=t,this.filters=n,this.id=e,this.alreadyHaveEvent=r.alreadyHaveEvent,this.receivedEvent=r.receivedEvent,this.eoseTimeout=r.eoseTimeout||t.baseEoseTimeout,this.oneose=r.oneose,this.onclose=r.onclose,this.onevent=r.onevent||(t=>{console.warn(`onevent() callback not defined for subscription '${this.id}' in relay ${this.relay.url}. event received:`,t)})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,this.oneose?.())}close(t="closed by caller"){!this.closed&&this.relay.connected&&(this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]"),this.closed=!0),this.relay.openSubs.delete(this.id),this.onclose?.(t)}};try{fa=WebSocket}catch{}var pa=class extends ha{constructor(t){super(t,{verifyEvent:ca,websocketImplementation:fa})}static async connect(t){const e=new pa(t);return await e.connect(),e}};function ya(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return ga(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ga(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return i=t.done,t},e:function(t){a=!0,s=t},f:function(){try{i||null==n.return||n.return()}finally{if(a)throw s}}}}function ga(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function wa(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function ma(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?wa(Object(n),!0).forEach((function(e){a(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):wa(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var ba=wp.i18n,va=(ba.__,ba._x),Ea=(ba._n,ba._nx,wp.element),xa=Ea.render,Ra=Ea.useEffect,Aa=Ea.useState,ka=Ea.Fragment,Sa=(Ea.useRef,{nip19:us,SimplePool:class extends ls{constructor(){super({verifyEvent:mr,websocketImplementation:cs})}},getEventHash:dr,Relay:pa}),_a=["wss://relay.damus.io","wss://nos.lol","wss://relay.nostr.band/"],Oa=function(t){var n=c(Aa(!0),2),o=n[0],i=n[1],a=c(Aa(!1),2),l=a[0],f=a[1];Ra((function(){window.addEventListener("load",(function(){window.nostr?setTimeout((function(){f({status:!0,data:!1})}),250):setTimeout((function(){f({status:!1,data:va("NIP-07 extension could not be detected. Make sure to have a NIP-07 extension installed, then reload this window and try again.","react component error","postr-for-nostr")})}),250)}))}),[]);var h=c(Aa(!1),2),d=h[0],p=h[1];Ra((function(){l&&l.status&&setTimeout((function(){postr_for_nostr_localize.data.post_data?postr_for_nostr_localize.data.post_type in postr_for_nostr_localize.data.post_types?p({status:!0,data:postr_for_nostr_localize.data.post_data}):p({status:!1,data:va("Posts from this post type cannot be postred.","component error","postr-for-nostr")}):p({status:!1,data:va("Invalid Post Data","component error","postr-for-nostr")})}),250)}),[l]);var y=c(Aa(!1),2),g=y[0],w=y[1];Ra((function(){!d||!d.status||g&&g.status||window.nostr.getPublicKey().catch((function(t){w({status:!1,data:t.message})})).then((function(t){t?(w({status:!0,data:t}),setTimeout((function(){document.body.classList.remove("postr-for-nostr-app--initializing"),i(!1)}),500)):w({status:!1,data:va("User denied","component error","postr-for-nostr")})}))}),[d]);var m=c(Aa(_a),2),b=m[0],v=m[1],E=c(Aa({name:va("Anonymous Postr","postr profile component name","postr-for-nostr"),picture:postr_for_nostr_localize.data.profile_placeholder,npub:"xxxxxxxxxxxxxxxxx",fetch:!0}),2),x=E[0],R=E[1];Ra((function(){if(g.status){R(ma(ma({},x),{},{npub:Sa.nip19.npubEncode(g.data),pubkey:g.data,fetch:!0})),new Sa.SimplePool;var t=function(){var t=s(u().mark((function t(e){var n,r;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n=new Sa.SimplePool,r=n.subscribeMany(e,[{authors:[g.data],kinds:[0,10002]}],{onevent:function(t){if(0===t.kind)try{var e=JSON.parse(t.content),n=ma({},x);n.pubkey=g.data,n.npub=Sa.nip19.npubEncode(g.data),n.fetch=!1,e.picture&&e.picture.length&&(n.picture=e.picture),e.username&&e.username.length&&(n.name=e.username),e.displayName&&e.displayName.length&&(n.name=e.displayName),e.display_name&&e.display_name.length&&(n.name=e.display_name),R(n)}catch(t){console.error("Error parsing profile metadata:",t)}if(10002===t.kind)try{var r={};t.tags.forEach((function(t){"r"===t[0]&&t[1]&&""!==t[1]&&(r[t[1]]={read:!0,write:!0},t[2]&&!t[3]&&"read"===t[2]&&(r[t[1]].write=!1),t[2]&&!t[3]&&"write"===t[2]&&(r[t[1]].read=!1))})),Object.keys(r).length>0&&v(r)}catch(t){console.error("Error parsing relay list:",t)}},oneose:function(){console.log("EOSE: Completed initial relay sync")}}),t.abrupt("return",r);case 6:return t.prev=6,t.t0=t.catch(0),console.error("Error connecting to relays:",t.t0),t.abrupt("return",null);case 10:case"end":return t.stop()}}),t,null,[[0,6]])})));return function(e){return t.apply(this,arguments)}}();t(b)}}),[g]);var A=c(Aa(""),2),k=A[0],S=A[1],_=c(Aa({total:0,list:[]}),2),O=_[0],L=_[1];Ra((function(){if(!o){var t=0;Object.keys(d.data.taxonomies).map((function(e){t+=Object.keys(d.data.taxonomies[e].terms).length})),L(ma(ma({},O),{},{total:t}));var e="".concat(d.data.title,"\n\n");d.data.excerpt.length&&(e+="".concat(d.data.excerpt,"\n\n")),e+=d.data.permalink,S(e)}}),[o]);var I=function(t){return React.createElement(ka,null,React.createElement("div",{className:"postr-for-nostr-app__state-loader"},t.state?t.state.status?"":"":React.createElement("div",{class:"postr-for-nostr-app__spinner"},React.createElement("div",null),React.createElement("div",null),React.createElement("div",null),React.createElement("div",null))),!1===t.state||t.state.status?t.task:t.state.data)},U=function(t){return React.createElement("div",{className:"postr-for-nostr-app__verify-nip07"},React.createElement("ul",{className:"postr-for-nostr-app__state-indicator-list"},React.createElement("li",null,React.createElement(I,{state:l,task:va("Looking for NIP-07 extension","component initalize task","postr-for-nostr")})),React.createElement("li",null,React.createElement(I,{state:d,task:va("Verifying post data","component initalize task","postr-for-nostr")})),React.createElement("li",null,React.createElement(I,{state:g,task:va("Retrieving public key","component initalize task","postr-for-nostr")}))))},N=c(Aa(!1),2),T=N[0],B=N[1],P=function(t){var e=c(Aa(!1),2),n=e[0],r=e[1],o=c(Aa(""),2),s=o[0],i=o[1],a=function(){var t=Object.assign({},b);t[s]={read:!0,write:!0},v(t)};return React.createElement("div",{className:"postr-for-nostr-app__postr-relays"},b&&React.createElement("button",{type:"button",className:"postr-for-nostr-app__postr-relays-toggle",onClick:function(){return B(!T)}},React.createElement("span",{className:"postr-for-nostr-app__postr-relays-toggle-title"},Object.keys(b).length+" Relays"),React.createElement("span",{className:"postr-for-nostr-app__postr-relays-toggle-horizontal"},React.createElement("span",{className:"postr-for-nostr-app__postr-relays-toggle-line"}),T&&React.createElement("span",{class:"dashicons dashicons-arrow-down-alt2"}),!T&&React.createElement("span",{class:"dashicons dashicons-arrow-up-alt2"}))),b&&T&&React.createElement("ul",{className:"postr-for-nostr-app__postr-relays"},Object.keys(b).map((function(t){if(t.length)return React.createElement("li",{key:t},React.createElement("span",{className:"postr-for-nostr-app__postr-relay-label"},t),React.createElement("button",{title:"Remove Relay",type:"button",onClick:function(){var e=Object.assign({},b);delete e[t],v(e)}},React.createElement("span",{className:"dashicons dashicons-remove"})))})),React.createElement("li",{class:"postr-for-nostr-app__postr-relay-add"},React.createElement("input",{placeholder:"Add relay ",value:s,className:"postr-for-nostr-app__postr-relay-label",onChange:function(t){var e,n=(e=t.target.value,/^wss:\/\/[^\/]{2,}\.[^\/]{2,}.*$/.test(e));r(!!n),i(t.target.value)},onKeyDown:function(t){"Enter"==t.key&&(t.preventDefault(),n&&a())}}),React.createElement("button",{title:va("Add Relay","relays component button label","postr-for-nostr"),type:"button",disabled:!n,onClick:a},n?React.createElement("span",{class:"dashicons dashicons-insert"}):React.createElement("span",{class:"dashicons dashicons-info-outline"})))))},$=c(Aa(!1),2),j=$[0],C=$[1],H=function(t){var e=c(Aa(!1),2),n=e[0],r=e[1],o=c(Aa(""),2),s=o[0],i=o[1],a=function(){if(!O.list["custom-"+s.toLowerCase()]){var t=Object.assign({},O);t.list["custom-"+s.toLowerCase()]=s;var e=0;Object.keys(d.data.taxonomies).map((function(t){e+=Object.keys(d.data.taxonomies[t].terms).length})),Object.keys(t.list).map((function(t){t.startsWith("custom-")&&e++})),t.total=e,L(t)}};return React.createElement("div",{className:"postr-for-nostr-app__postr-tags"},O&&React.createElement("button",{type:"button",className:"postr-for-nostr-app__postr-tags-toggle",onClick:function(){return C(!j)}},React.createElement("span",{className:"postr-for-nostr-app__postr-tags-toggle-title"},Object.keys(O.list).length+"/"+O.total+" Tags"),React.createElement("span",{className:"postr-for-nostr-app__postr-tags-toggle-horizontal"},React.createElement("span",{className:"postr-for-nostr-app__postr-tags-toggle-line"}),j&&React.createElement("span",{class:"dashicons dashicons-arrow-down-alt2"}),!j&&React.createElement("span",{class:"dashicons dashicons-arrow-up-alt2"}))),O&&j&&React.createElement(ka,null,React.createElement("p",{className:"postr-for-nostr-app__postr-tag-notice"},React.createElement("i",null,va("These tags are added as type t tags in the Nostr event object.","tags component notice","postr-for-nostr"))),React.createElement("div",{className:"postr-for-nostr-app__postr-tag-types"},Object.keys(d.data.taxonomies).map((function(t){if(Object.keys(d.data.taxonomies[t].terms).length)return React.createElement("div",null,React.createElement("h5",null,d.data.taxonomies[t].name),React.createElement("ul",null,Object.keys(d.data.taxonomies[t].terms).map((function(e){var n=t+"-"+e;return React.createElement("li",null,React.createElement("label",null,React.createElement("input",{type:"checkbox",checked:O.list[n],value:n,onClick:function(){var r=Object.assign({},O);r.list[n]?delete r.list[n]:r.list[n]=d.data.taxonomies[t].terms[e],L(r)}}),d.data.taxonomies[t].terms[e]))}))))})),React.createElement("div",{className:"postr-for-nostr-app__postr-tags-custom"},React.createElement("h5",null,va("Add custom tags","tags component title","postr-for-nostr")),React.createElement("ul",null,Object.keys(O.list).map((function(t){if(t.startsWith("custom-"))return React.createElement("li",{key:t},React.createElement("span",{className:"postr-for-nostr-app__postr-tag-label"},O.list[t]),React.createElement("button",{title:"Remove Tag",type:"button",onClick:function(){var e=Object.assign({},O);delete e.list[t],L(e)}},React.createElement("span",{className:"dashicons dashicons-remove"})))})),React.createElement("li",{class:"postr-for-nostr-app__postr-tag-add"},React.createElement("input",{placeholder:"Add tag ",value:s,className:"postr-for-nostr-app__postr-tag-label",onChange:function(t){var e,n=(e=t.target.value,/^[a-zA-Z0-9]+$/.test(e)||O.list["custom-"+t.target.value.toLowerCase()]);r(!!n),i(t.target.value)},onKeyDown:function(t){"Enter"==t.key&&(t.preventDefault(),n&&a())}}),React.createElement("button",{title:va("Add tag","tags component button label","postr-for-nostr"),disabled:!n||void 0!==O.list["custom-"+s.toLowerCase()],type:"button",onClick:a},n?React.createElement("span",{class:"dashicons dashicons-insert"}):React.createElement("span",{class:"dashicons dashicons-info-outline"}))))))))},M=c(Aa(!1),2),q=M[0],z=M[1],W=function(t){return t.preventDefault(),z(!0),!1},D=function(){return React.createElement("div",{className:"postr-for-nostr-app__postr"},React.createElement("h2",{className:"postr-for-nostr-app__postr-title"},va("Postr For Nostr","form component title","postr-for-nostr")),!q&&React.createElement(K,null),q&&React.createElement(F,null))},K=function(){return React.createElement("form",{className:"postr-for-nostr-app__postr-form",onSubmit:W},React.createElement("fieldset",{className:"postr-for-nostr-app__postr-profile"},React.createElement("label",null,React.createElement("strong",null,va("Profile","form component label","postr-for-nostr"))),React.createElement("div",null,React.createElement("figure",null,x.picture&&React.createElement("img",{src:x.picture,alt:va("Profile image","form component image alt title","postr-for-nostr")})),React.createElement("p",null,React.createElement("strong",null,x.name),React.createElement("span",null,(e=(t=x.npub).substring(0,8),e+=":",e+=t.substring(t.length-8)))))),React.createElement("fieldset",null,React.createElement("label",null,React.createElement("strong",null,va("Note","form component label","postr-for-nostr"))),React.createElement("div",null,React.createElement("textarea",{name:"note",defaultValue:k,placeholder:va("Write notes and other stuff","form component textare placeholder","postr-for-nostr"),rows:6,onBlur:function(t){var e=t.target.value;S(e)}}),React.createElement("ul",null,Object.keys(O.list).map((function(t){return React.createElement("li",null,"#"+O.list[t])}))))),React.createElement("fieldset",null,React.createElement("label",null,React.createElement("strong",null,va("Tags","form component label","postr-for-nostr"))),React.createElement("div",null,React.createElement(H,null))),React.createElement("fieldset",null,React.createElement("label",null,React.createElement("strong",null,va("Relays","form component label","postr-for-nostr"))),React.createElement("div",null,React.createElement(P,null))),React.createElement("fieldset",{className:"postr-for-nostr-app__postr-actions"},React.createElement("label",null,React.createElement("strong",null,va("Form Actions","form component label","postr-for-nostr"))),React.createElement("div",null,React.createElement("button",{type:"submit",className:"button button-primary"},va("Transmit to Nostr","form component button label","postr-for-nostr")))));var t,e},F=function(){var t=c(Aa(!1),2),n=t[0],o=t[1],i=c(Aa([]),2),a=i[0],l=i[1],f=c(Aa(b),2),h=f[0],d=f[1];return Ra((function(){var t={kind:1,pubkey:g.data,created_at:Math.floor(Date.now()/1e3),tags:[],content:k};for(var n in O.list)t.tags.push(["t",O.list[n]]);t.id=Sa.getEventHash(t),window.nostr.signEvent(t).then(function(){var t=s(u().mark((function t(e){var n,r;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o(e),n=Object.keys(b),t.next=4,La(n,e);case 4:r=t.sent,d((function(t){var e=ma({},t);return r.forEach((function(t,n){e[n]?e[n]=ma(ma({},e[n]),{},{success:t.success,message:t.message}):e[n]={init:null,pub:null,success:t.success,message:t.message}})),e}));case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(t){var n;l([].concat(function(t){if(Array.isArray(t))return e(t)}(n=a)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(n)||r(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),[{title:va("Event could not be signed","postring component error","postr-for-nostr"),message:t.message}]))}))}),[]),React.createElement("div",{className:"postr-for-nostr-app__postring"},!a.length&&React.createElement("div",{className:"postr-for-nostr-app__postring-status"},React.createElement("div",null,React.createElement("strong",null,va("Event ID","postring component title","postr-for-nostr")),React.createElement("br",null),n?n.id:React.createElement("div",{class:"postr-for-nostr-app__spinner"},React.createElement("div",null),React.createElement("div",null),React.createElement("div",null),React.createElement("div",null))),React.createElement("ul",null,Object.keys(b).map((function(t){return React.createElement("li",null,void 0===h[t].success?React.createElement("div",{class:"postr-for-nostr-app__spinner"},React.createElement("div",null),React.createElement("div",null),React.createElement("div",null),React.createElement("div",null)):h[t].success?React.createElement("div",null,""):React.createElement("div",null,""),React.createElement("strong",null,t))})))),!!a.length&&React.createElement("div",{className:"postr-for-nostr-app__postring-errors"},React.createElement("span",null,""),React.createElement("h3",null,va("Failed to postr for the following reasons:","postring component error","postr-for-nostr")),React.createElement("ul",null,a.map((function(t){return React.createElement("li",null,React.createElement("strong",null,t.title),React.createElement("br",null),t.message)}))),React.createElement("button",{type:"button",onClick:function(){window.location.reload()}},va("Reload and try again","postring component button label","postr-for-nostr"))))};return React.createElement(ka,null,o&&React.createElement(U,null),!o&&React.createElement(D,null))};function La(t,e){return Ia.apply(this,arguments)}function Ia(){return(Ia=s(u().mark((function t(e,n){var r,o,s,i,a;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=new Map,o=ya(e),t.prev=2,o.s();case 4:if((s=o.n()).done){t.next=29;break}return i=s.value,a=void 0,t.prev=7,t.next=10,pa.connect(i);case 10:return a=t.sent,console.log("Connected to ".concat(i)),t.next=14,a.publish(n);case 14:console.log("Successfully sent event to ".concat(i)),r.set(i,{success:!0}),t.next=22;break;case 18:t.prev=18,t.t0=t.catch(7),console.error("Failed to connect or send event to ".concat(i,":"),t.t0.message),r.set(i,{success:!1,message:t.t0.message});case 22:return t.prev=22,a&&(a.close(),console.log("Disconnected from ".concat(i))),t.finish(22);case 25:return t.next=27,new Promise((function(t){return setTimeout(t,300)}));case 27:t.next=4;break;case 29:t.next=34;break;case 31:t.prev=31,t.t1=t.catch(2),o.e(t.t1);case 34:return t.prev=34,o.f(),t.finish(34);case 37:return t.abrupt("return",r);case 38:case"end":return t.stop()}}),t,null,[[2,31,34,37],[7,18,22,25]])})))).apply(this,arguments)}const Ua=document.getElementById("postr-for-nostr-app");var Na;Ua&&(Na=Ua,xa(React.createElement(Oa,null),Na))})()})();